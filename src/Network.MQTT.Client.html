<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621679113891"><span id="local-6989586621679113892"></span></span><span class="hs-comment">{-|
Module      : Network.MQTT.Client.
Description : An MQTT client.
Copyright   : (c) Dustin Sallings, 2019
License     : BSD3
Maintainer  : dustin@spy.net
Stability   : experimental

An MQTT protocol client

Both
&lt;http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html MQTT 3.1.1&gt;
and
&lt;https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html MQTT 5.0&gt;
are supported over plain TCP, TLS, WebSockets and Secure WebSockets.
-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns    #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards   #-}</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.MQTT.Client</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Configuring the client.</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier">MQTTConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier">MQTTClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#QoS"><span class="hs-identifier">QoS</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier">Topic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#mqttConfig"><span class="hs-identifier">mqttConfig</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#mkLWT"><span class="hs-identifier">mkLWT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#LastWill"><span class="hs-identifier">LastWill</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Network.MQTT.Types.html#ProtocolLevel"><span class="hs-identifier">ProtocolLevel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier">Property</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#SubOptions"><span class="hs-identifier">SubOptions</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#subOptions"><span class="hs-identifier">subOptions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MessageCallback"><span class="hs-identifier">MessageCallback</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Running and waiting for the client.</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#waitForClient"><span class="hs-identifier">waitForClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#connectURI"><span class="hs-identifier">connectURI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#isConnected"><span class="hs-identifier">isConnected</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#disconnect"><span class="hs-identifier">disconnect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#normalDisconnect"><span class="hs-identifier">normalDisconnect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#stopClient"><span class="hs-identifier">stopClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-comment">-- * General client interactions.</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#subscribe"><span class="hs-identifier">subscribe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#unsubscribe"><span class="hs-identifier">unsubscribe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#publish"><span class="hs-identifier">publish</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#publishq"><span class="hs-identifier">publishq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#pubAliased"><span class="hs-identifier">pubAliased</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#svrProps"><span class="hs-identifier">svrProps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#connACK"><span class="hs-identifier">connACK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier">MQTTException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Low-level bits</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#runMQTTConduit"><span class="hs-identifier">runMQTTConduit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConduit"><span class="hs-identifier">MQTTConduit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#isConnectedSTM"><span class="hs-identifier">isConnectedSTM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#connACKSTM"><span class="hs-identifier">connACKSTM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Network.MQTT.Client.html#registerCorrelated"><span class="hs-identifier">registerCorrelated</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#unregisterCorrelated"><span class="hs-identifier">unregisterCorrelated</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">myThreadId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Async</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">async</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asyncThreadId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cancel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cancelWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">link</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">race_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">wait</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>                                             </span><span class="annot"><span class="hs-identifier">waitAnyCancel</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">STM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TChan</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">atomically</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">check</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modifyTVar'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newTChan</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newTChanIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>                                             </span><span class="annot"><span class="hs-identifier">newTVarIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">orElse</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readTChan</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readTVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readTVarIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">registerDelay</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">retry</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>                                             </span><span class="annot"><span class="hs-identifier">writeTChan</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeTVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">force</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forever</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">join</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BCS</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BC</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit</span></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConduitT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">await</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runConduit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">yield</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.|)</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit.Attoparsec</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">conduitParser</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Conduit.Combinators</span></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit.Network</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AppData</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">appSink</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">appSource</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">clientSettings</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runTCPClient</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit.Network.TLS</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runTLSClient</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tlsClientConfig</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tlsClientTLSSettings</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.Map.Strict.Decaying.html"><span class="hs-identifier">Data.Map.Strict.Decaying</span></a></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Decaying</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TE</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">labelThread</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.Connection</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConnectionParams</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TLSSettings</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">connectTo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">connectionClose</span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>                                             </span><span class="annot"><span class="hs-identifier">connectionGetChunk</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">connectionPut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">initConnectionContext</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.URI</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">URI</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nullURIAuth</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unEscapeString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uriPort</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uriRegName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uriUserInfo</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.WebSockets</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.WebSockets.Stream</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeStream</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Error</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catchIOError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isEOFError</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Timeout</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">timeout</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Network.MQTT.Topic.html"><span class="hs-identifier">Network.MQTT.Topic</span></a></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Topic.html#Filter"><span class="hs-identifier">Filter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier">Topic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#mkTopic"><span class="hs-identifier">mkTopic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#unFilter"><span class="hs-identifier">unFilter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#unTopic"><span class="hs-identifier">unTopic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Network.MQTT.Types.html"><span class="hs-identifier">Network.MQTT.Types</span></a></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">data</span><span> </span><span id="ConnState"><span class="annot"><a href="Network.MQTT.Client.html#ConnState"><span class="hs-identifier hs-var">ConnState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Starting"><span class="annot"><a href="Network.MQTT.Client.html#Starting"><span class="hs-identifier hs-var">Starting</span></a></span></span><span>
</span><span id="line-81"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="Connected"><span class="annot"><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span></span><span>
</span><span id="line-82"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="Stopped"><span class="annot"><a href="Network.MQTT.Client.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span></span><span>
</span><span id="line-83"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="Disconnected"><span class="annot"><a href="Network.MQTT.Client.html#Disconnected"><span class="hs-identifier hs-var">Disconnected</span></a></span></span><span>
</span><span id="line-84"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="DiscoErr"><span class="annot"><a href="Network.MQTT.Client.html#DiscoErr"><span class="hs-identifier hs-var">DiscoErr</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#DisconnectRequest"><span class="hs-identifier hs-type">DisconnectRequest</span></a></span><span>
</span><span id="line-85"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="ConnErr"><span class="annot"><a href="Network.MQTT.Client.html#ConnErr"><span class="hs-identifier hs-var">ConnErr</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-type">ConnACKFlags</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113594"><span id="local-6989586621679113600"><span class="annot"><span class="annottext">ConnState -&gt; ConnState -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ConnState -&gt; ConnState -&gt; Bool
$c/= :: ConnState -&gt; ConnState -&gt; Bool
== :: ConnState -&gt; ConnState -&gt; Bool
$c== :: ConnState -&gt; ConnState -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113581"><span id="local-6989586621679113583"><span id="local-6989586621679113591"><span class="annot"><span class="annottext">Int -&gt; ConnState -&gt; ShowS
[ConnState] -&gt; ShowS
ConnState -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ConnState] -&gt; ShowS
$cshowList :: [ConnState] -&gt; ShowS
show :: ConnState -&gt; String
$cshow :: ConnState -&gt; String
showsPrec :: Int -&gt; ConnState -&gt; ShowS
$cshowsPrec :: Int -&gt; ConnState -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">data</span><span> </span><span id="DispatchType"><span class="annot"><a href="Network.MQTT.Client.html#DispatchType"><span class="hs-identifier hs-var">DispatchType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DSubACK"><span class="annot"><a href="Network.MQTT.Client.html#DSubACK"><span class="hs-identifier hs-var">DSubACK</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DUnsubACK"><span class="annot"><a href="Network.MQTT.Client.html#DUnsubACK"><span class="hs-identifier hs-var">DUnsubACK</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DPubACK"><span class="annot"><a href="Network.MQTT.Client.html#DPubACK"><span class="hs-identifier hs-var">DPubACK</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DPubREC"><span class="annot"><a href="Network.MQTT.Client.html#DPubREC"><span class="hs-identifier hs-var">DPubREC</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DPubREL"><span class="annot"><a href="Network.MQTT.Client.html#DPubREL"><span class="hs-identifier hs-var">DPubREL</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DPubCOMP"><span class="annot"><a href="Network.MQTT.Client.html#DPubCOMP"><span class="hs-identifier hs-var">DPubCOMP</span></a></span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113570"><span id="local-6989586621679113572"><span class="annot"><span class="annottext">DispatchType -&gt; DispatchType -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: DispatchType -&gt; DispatchType -&gt; Bool
$c/= :: DispatchType -&gt; DispatchType -&gt; Bool
== :: DispatchType -&gt; DispatchType -&gt; Bool
$c== :: DispatchType -&gt; DispatchType -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113564"><span id="local-6989586621679113566"><span id="local-6989586621679113568"><span class="annot"><span class="annottext">Int -&gt; DispatchType -&gt; ShowS
[DispatchType] -&gt; ShowS
DispatchType -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [DispatchType] -&gt; ShowS
$cshowList :: [DispatchType] -&gt; ShowS
show :: DispatchType -&gt; String
$cshow :: DispatchType -&gt; String
showsPrec :: Int -&gt; DispatchType -&gt; ShowS
$cshowsPrec :: Int -&gt; DispatchType -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113545"><span id="local-6989586621679113547"><span id="local-6989586621679113550"><span id="local-6989586621679113553"><span id="local-6989586621679113556"><span id="local-6989586621679113558"><span id="local-6989586621679113560"><span class="annot"><span class="annottext">Eq DispatchType
DispatchType -&gt; DispatchType -&gt; Bool
DispatchType -&gt; DispatchType -&gt; Ordering
DispatchType -&gt; DispatchType -&gt; DispatchType
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: DispatchType -&gt; DispatchType -&gt; DispatchType
$cmin :: DispatchType -&gt; DispatchType -&gt; DispatchType
max :: DispatchType -&gt; DispatchType -&gt; DispatchType
$cmax :: DispatchType -&gt; DispatchType -&gt; DispatchType
&gt;= :: DispatchType -&gt; DispatchType -&gt; Bool
$c&gt;= :: DispatchType -&gt; DispatchType -&gt; Bool
&gt; :: DispatchType -&gt; DispatchType -&gt; Bool
$c&gt; :: DispatchType -&gt; DispatchType -&gt; Bool
&lt;= :: DispatchType -&gt; DispatchType -&gt; Bool
$c&lt;= :: DispatchType -&gt; DispatchType -&gt; Bool
&lt; :: DispatchType -&gt; DispatchType -&gt; Bool
$c&lt; :: DispatchType -&gt; DispatchType -&gt; Bool
compare :: DispatchType -&gt; DispatchType -&gt; Ordering
$ccompare :: DispatchType -&gt; DispatchType -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113506"><span id="local-6989586621679113508"><span id="local-6989586621679113512"><span id="local-6989586621679113516"><span id="local-6989586621679113518"><span id="local-6989586621679113529"><span id="local-6989586621679113535"><span id="local-6989586621679113542"><span class="annot"><span class="annottext">Int -&gt; DispatchType
DispatchType -&gt; Int
DispatchType -&gt; [DispatchType]
DispatchType -&gt; DispatchType
DispatchType -&gt; DispatchType -&gt; [DispatchType]
DispatchType -&gt; DispatchType -&gt; DispatchType -&gt; [DispatchType]
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
enumFromThenTo :: DispatchType -&gt; DispatchType -&gt; DispatchType -&gt; [DispatchType]
$cenumFromThenTo :: DispatchType -&gt; DispatchType -&gt; DispatchType -&gt; [DispatchType]
enumFromTo :: DispatchType -&gt; DispatchType -&gt; [DispatchType]
$cenumFromTo :: DispatchType -&gt; DispatchType -&gt; [DispatchType]
enumFromThen :: DispatchType -&gt; DispatchType -&gt; [DispatchType]
$cenumFromThen :: DispatchType -&gt; DispatchType -&gt; [DispatchType]
enumFrom :: DispatchType -&gt; [DispatchType]
$cenumFrom :: DispatchType -&gt; [DispatchType]
fromEnum :: DispatchType -&gt; Int
$cfromEnum :: DispatchType -&gt; Int
toEnum :: Int -&gt; DispatchType
$ctoEnum :: Int -&gt; DispatchType
pred :: DispatchType -&gt; DispatchType
$cpred :: DispatchType -&gt; DispatchType
succ :: DispatchType -&gt; DispatchType
$csucc :: DispatchType -&gt; DispatchType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113501"><span id="local-6989586621679113503"><span class="annot"><span class="annottext">DispatchType
forall a. a -&gt; a -&gt; Bounded a
maxBound :: DispatchType
$cmaxBound :: DispatchType
minBound :: DispatchType
$cminBound :: DispatchType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Bounded</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Callback invoked on each incoming subscribed message.</span><span>
</span><span id="line-92"></span><span class="hs-keyword">data</span><span> </span><span id="MessageCallback"><span class="annot"><a href="Network.MQTT.Client.html#MessageCallback"><span class="hs-identifier hs-var">MessageCallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NoCallback"><span class="annot"><a href="Network.MQTT.Client.html#NoCallback"><span class="hs-identifier hs-var">NoCallback</span></a></span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- | Callbacks will be invoked asynchronously, ordering is likely preserved, but not guaranteed.</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- In high throughput scenarios, slow callbacks may result in a high number of Haskell threads,</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">-- potentially bringing down the entire application when running out of memory.</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-comment">-- Typically faster than `OrderedCallback`.</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SimpleCallback"><span class="annot"><a href="Network.MQTT.Client.html#SimpleCallback"><span class="hs-identifier hs-var">SimpleCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-comment">-- | Callbacks are guaranteed to be invoked in the same order messages are received.</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-comment">-- In high throughput scenarios, slow callbacks may cause the underlying TCP connection to block,</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-comment">-- potentially being terminated by the broker.</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-comment">-- Typically slower than `SimpleCallback`.</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OrderedCallback"><span class="annot"><a href="Network.MQTT.Client.html#OrderedCallback"><span class="hs-identifier hs-var">OrderedCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-comment">-- | A LowLevelCallback receives the client and the entire publish request, providing</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-comment">-- access to all of the fields of the request.  This is slightly harder to use than</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-comment">-- SimpleCallback for common cases, but there are cases where you need all the things.</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LowLevelCallback"><span class="annot"><a href="Network.MQTT.Client.html#LowLevelCallback"><span class="hs-identifier hs-var">LowLevelCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- | A low level callback that is ordered.</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OrderedLowLevelCallback"><span class="annot"><a href="Network.MQTT.Client.html#OrderedLowLevelCallback"><span class="hs-identifier hs-var">OrderedLowLevelCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- | The MQTT client.</span><span>
</span><span id="line-112"></span><span class="hs-comment">--</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- See 'connectURI' for the most straightforward example.</span><span>
</span><span id="line-114"></span><span class="hs-keyword">data</span><span> </span><span id="MQTTClient"><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-var">MQTTClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MQTTClient"><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-var">MQTTClient</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-115"></span><span>  </span><span id="_ch"><span class="annot"><span class="annottext">MQTTClient -&gt; TChan MQTTPkt
</span><a href="Network.MQTT.Client.html#_ch"><span class="hs-identifier hs-var hs-var">_ch</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_pktID"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar Word16
</span><a href="Network.MQTT.Client.html#_pktID"><span class="hs-identifier hs-var hs-var">_pktID</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_cb"><span class="annot"><span class="annottext">MQTTClient -&gt; MessageCallback
</span><a href="Network.MQTT.Client.html#_cb"><span class="hs-identifier hs-var hs-var">_cb</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MessageCallback"><span class="hs-identifier hs-type">MessageCallback</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_acks"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
</span><a href="Network.MQTT.Client.html#_acks"><span class="hs-identifier hs-var hs-var">_acks</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#DispatchType"><span class="hs-identifier hs-type">DispatchType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_inflight"><span class="annot"><span class="annottext">MQTTClient -&gt; Map Word16 PublishRequest
</span><a href="Network.MQTT.Client.html#_inflight"><span class="hs-identifier hs-var hs-var">_inflight</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Map.Strict.Decaying.html#Map"><span class="hs-identifier hs-type">Decaying.Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_st"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar ConnState
</span><a href="Network.MQTT.Client.html#_st"><span class="hs-identifier hs-var hs-var">_st</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#ConnState"><span class="hs-identifier hs-type">ConnState</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_ct"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar (Maybe (Async ()))
</span><a href="Network.MQTT.Client.html#_ct"><span class="hs-identifier hs-var hs-var">_ct</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_outA"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar (Map Topic Word16)
</span><a href="Network.MQTT.Client.html#_outA"><span class="hs-identifier hs-var hs-var">_outA</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_inA"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar (Map Word16 Topic)
</span><a href="Network.MQTT.Client.html#_inA"><span class="hs-identifier hs-var hs-var">_inA</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_connACKFlags"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar ConnACKFlags
</span><a href="Network.MQTT.Client.html#_connACKFlags"><span class="hs-identifier hs-var hs-var">_connACKFlags</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-type">ConnACKFlags</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_corr"><span class="annot"><span class="annottext">MQTTClient -&gt; Map ByteString MessageCallback
</span><a href="Network.MQTT.Client.html#_corr"><span class="hs-identifier hs-var hs-var">_corr</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Map.Strict.Decaying.html#Map"><span class="hs-identifier hs-type">Decaying.Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MessageCallback"><span class="hs-identifier hs-type">MessageCallback</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_cbM"><span class="annot"><span class="annottext">MQTTClient -&gt; MVar (IO ())
</span><a href="Network.MQTT.Client.html#_cbM"><span class="hs-identifier hs-var hs-var">_cbM</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_cbHandle"><span class="annot"><span class="annottext">MQTTClient -&gt; TVar (Maybe (Async ()))
</span><a href="Network.MQTT.Client.html#_cbHandle"><span class="hs-identifier hs-var hs-var">_cbHandle</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | Configuration for setting up an MQTT client.</span><span>
</span><span id="line-131"></span><span class="hs-keyword">data</span><span> </span><span id="MQTTConfig"><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-var">MQTTConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MQTTConfig"><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-var">MQTTConfig</span></a></span></span><span class="hs-special">{</span><span>
</span><span id="line-132"></span><span>  </span><span id="_cleanSession"><span class="annot"><span class="annottext">MQTTConfig -&gt; Bool
</span><a href="Network.MQTT.Client.html#_cleanSession"><span class="hs-identifier hs-var hs-var">_cleanSession</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ False if a session should be reused.</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_lwt"><span class="annot"><span class="annottext">MQTTConfig -&gt; Maybe LastWill
</span><a href="Network.MQTT.Client.html#_lwt"><span class="hs-identifier hs-var hs-var">_lwt</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#LastWill"><span class="hs-identifier hs-type">LastWill</span></a></span><span> </span><span class="hs-comment">-- ^ LastWill message to be sent on client disconnect.</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_msgCB"><span class="annot"><span class="annottext">MQTTConfig -&gt; MessageCallback
</span><a href="Network.MQTT.Client.html#_msgCB"><span class="hs-identifier hs-var hs-var">_msgCB</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MessageCallback"><span class="hs-identifier hs-type">MessageCallback</span></a></span><span> </span><span class="hs-comment">-- ^ Callback for incoming messages.</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_protocol"><span class="annot"><span class="annottext">MQTTConfig -&gt; ProtocolLevel
</span><a href="Network.MQTT.Client.html#_protocol"><span class="hs-identifier hs-var hs-var">_protocol</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#ProtocolLevel"><span class="hs-identifier hs-type">ProtocolLevel</span></a></span><span> </span><span class="hs-comment">-- ^ Protocol to use for the connection.</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_connProps"><span class="annot"><span class="annottext">MQTTConfig -&gt; [Property]
</span><a href="Network.MQTT.Client.html#_connProps"><span class="hs-identifier hs-var hs-var">_connProps</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Properties to send to the broker in the CONNECT packet.</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_hostname"><span class="annot"><span class="annottext">MQTTConfig -&gt; String
</span><a href="Network.MQTT.Client.html#_hostname"><span class="hs-identifier hs-var hs-var">_hostname</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-comment">-- ^ Host to connect to (parsed from the URI)</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_port"><span class="annot"><span class="annottext">MQTTConfig -&gt; Int
</span><a href="Network.MQTT.Client.html#_port"><span class="hs-identifier hs-var hs-var">_port</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ Port number (parsed from the URI)</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_connID"><span class="annot"><span class="annottext">MQTTConfig -&gt; String
</span><a href="Network.MQTT.Client.html#_connID"><span class="hs-identifier hs-var hs-var">_connID</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-comment">-- ^ Unique connection ID (parsed from the URI)</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_username"><span class="annot"><span class="annottext">MQTTConfig -&gt; Maybe String
</span><a href="Network.MQTT.Client.html#_username"><span class="hs-identifier hs-var hs-var">_username</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-comment">-- ^ Optional username (parsed from the URI)</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_password"><span class="annot"><span class="annottext">MQTTConfig -&gt; Maybe String
</span><a href="Network.MQTT.Client.html#_password"><span class="hs-identifier hs-var hs-var">_password</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-comment">-- ^ Optional password (parsed from the URI)</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_connectTimeout"><span class="annot"><span class="annottext">MQTTConfig -&gt; Int
</span><a href="Network.MQTT.Client.html#_connectTimeout"><span class="hs-identifier hs-var hs-var">_connectTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ Connection timeout (microseconds)</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_tlsSettings"><span class="annot"><span class="annottext">MQTTConfig -&gt; TLSSettings
</span><a href="Network.MQTT.Client.html#_tlsSettings"><span class="hs-identifier hs-var hs-var">_tlsSettings</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLSSettings</span></span><span> </span><span class="hs-comment">-- ^ TLS Settings for secure connections</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_pingPeriod"><span class="annot"><span class="annottext">MQTTConfig -&gt; Int
</span><a href="Network.MQTT.Client.html#_pingPeriod"><span class="hs-identifier hs-var hs-var">_pingPeriod</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ Time in seconds between pings</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_pingPatience"><span class="annot"><span class="annottext">MQTTConfig -&gt; Int
</span><a href="Network.MQTT.Client.html#_pingPatience"><span class="hs-identifier hs-var hs-var">_pingPatience</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ Time in seconds for which there must be no incoming packets before the broker is considered dead. Should be more than the ping period plus the maximum expected ping round trip time.</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | A default 'MQTTConfig'.  A '_connID' /may/ be required depending on</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- your broker (or if you just want an identifiable/resumable</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- connection).  In MQTTv5, an empty connection ID may be sent and the</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- server may assign an identifier for you and return it in the</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- 'PropAssignedClientIdentifier' 'Property'.</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Network.MQTT.Client.html#mqttConfig"><span class="hs-identifier hs-type">mqttConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span>
</span><span id="line-154"></span><span id="mqttConfig"><span class="annot"><span class="annottext">mqttConfig :: MQTTConfig
</span><a href="Network.MQTT.Client.html#mqttConfig"><span class="hs-identifier hs-var hs-var">mqttConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_hostname :: String
</span><a href="Network.MQTT.Client.html#_hostname"><span class="hs-identifier hs-var">_hostname</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_port :: Int
</span><a href="Network.MQTT.Client.html#_port"><span class="hs-identifier hs-var">_port</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1883</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_connID :: String
</span><a href="Network.MQTT.Client.html#_connID"><span class="hs-identifier hs-var">_connID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>                        </span><span class="annot"><span class="annottext">_username :: Maybe String
</span><a href="Network.MQTT.Client.html#_username"><span class="hs-identifier hs-var">_username</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_password :: Maybe String
</span><a href="Network.MQTT.Client.html#_password"><span class="hs-identifier hs-var">_password</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>                        </span><span class="annot"><span class="annottext">_cleanSession :: Bool
</span><a href="Network.MQTT.Client.html#_cleanSession"><span class="hs-identifier hs-var">_cleanSession</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_lwt :: Maybe LastWill
</span><a href="Network.MQTT.Client.html#_lwt"><span class="hs-identifier hs-var">_lwt</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>                        </span><span class="annot"><span class="annottext">_msgCB :: MessageCallback
</span><a href="Network.MQTT.Client.html#_msgCB"><span class="hs-identifier hs-var">_msgCB</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">MessageCallback
</span><a href="Network.MQTT.Client.html#NoCallback"><span class="hs-identifier hs-var">NoCallback</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>                        </span><span class="annot"><span class="annottext">_protocol :: ProtocolLevel
</span><a href="Network.MQTT.Client.html#_protocol"><span class="hs-identifier hs-var">_protocol</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">ProtocolLevel
</span><a href="Network.MQTT.Types.html#Protocol311"><span class="hs-identifier hs-var">Protocol311</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_connProps :: [Property]
</span><a href="Network.MQTT.Client.html#_connProps"><span class="hs-identifier hs-var">_connProps</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>                        </span><span class="annot"><span class="annottext">_connectTimeout :: Int
</span><a href="Network.MQTT.Client.html#_connectTimeout"><span class="hs-identifier hs-var">_connectTimeout</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">180000000</span></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>                        </span><span class="annot"><span class="annottext">_tlsSettings :: TLSSettings
</span><a href="Network.MQTT.Client.html#_tlsSettings"><span class="hs-identifier hs-var">_tlsSettings</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool -&gt; TLSSettings
</span><span class="hs-identifier hs-var">TLSSettingsSimple</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>                        </span><span class="annot"><span class="annottext">_pingPeriod :: Int
</span><a href="Network.MQTT.Client.html#_pingPeriod"><span class="hs-identifier hs-var">_pingPeriod</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30000000</span></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>                        </span><span class="annot"><span class="annottext">_pingPatience :: Int
</span><a href="Network.MQTT.Client.html#_pingPatience"><span class="hs-identifier hs-var">_pingPatience</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">90000000</span></span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Connect to an MQTT server by URI.</span><span>
</span><span id="line-165"></span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- @mqtt://@, @mqtts://@, @ws://@, and @wss://@ URLs are supported.</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- The host, port, username, and password will be derived from the URI</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- and the values supplied in the config will be ignored.</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- &gt; main :: IO</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- &gt; main = do</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- &gt;   let (Just uri) = parseURI &quot;mqtt://test.mosquitto.org&quot;</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- &gt;   mc &lt;- connectURI mqttConfig{} uri</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- &gt;   publish mc &quot;tmp/topic&quot; &quot;hello!&quot; False</span><span>
</span><span id="line-175"></span><span class="annot"><a href="Network.MQTT.Client.html#connectURI"><span class="hs-identifier hs-type">connectURI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">URI</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-176"></span><span id="connectURI"><span class="annot"><span class="annottext">connectURI :: MQTTConfig -&gt; URI -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#connectURI"><span class="hs-identifier hs-var hs-var">connectURI</span></a></span></span><span> </span><span id="local-6989586621679113462"><span class="annot"><span class="annottext">cfg :: MQTTConfig
</span><a href="#local-6989586621679113462"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113448"><span id="local-6989586621679113449"><span id="local-6989586621679113450"><span id="local-6989586621679113451"><span id="local-6989586621679113452"><span id="local-6989586621679113453"><span id="local-6989586621679113454"><span id="local-6989586621679113455"><span id="local-6989586621679113456"><span id="local-6989586621679113457"><span id="local-6989586621679113458"><span id="local-6989586621679113459"><span id="local-6989586621679113460"><span id="local-6989586621679113461"><span class="annot"><span class="annottext">Bool
Int
String
[Property]
Maybe String
Maybe LastWill
ProtocolLevel
TLSSettings
MessageCallback
_pingPatience :: Int
_pingPeriod :: Int
_tlsSettings :: TLSSettings
_connectTimeout :: Int
_password :: Maybe String
_username :: Maybe String
_connID :: String
_port :: Int
_hostname :: String
_connProps :: [Property]
_protocol :: ProtocolLevel
_msgCB :: MessageCallback
_lwt :: Maybe LastWill
_cleanSession :: Bool
_pingPatience :: MQTTConfig -&gt; Int
_pingPeriod :: MQTTConfig -&gt; Int
_tlsSettings :: MQTTConfig -&gt; TLSSettings
_connectTimeout :: MQTTConfig -&gt; Int
_password :: MQTTConfig -&gt; Maybe String
_username :: MQTTConfig -&gt; Maybe String
_connID :: MQTTConfig -&gt; String
_port :: MQTTConfig -&gt; Int
_hostname :: MQTTConfig -&gt; String
_connProps :: MQTTConfig -&gt; [Property]
_protocol :: MQTTConfig -&gt; ProtocolLevel
_msgCB :: MQTTConfig -&gt; MessageCallback
_lwt :: MQTTConfig -&gt; Maybe LastWill
_cleanSession :: MQTTConfig -&gt; Bool
</span><a href="#local-6989586621679113448"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679113447"><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113434"><span class="annot"><span class="annottext">cf :: MQTTConfig -&gt; IO MQTTClient
</span><a href="#local-6989586621679113434"><span class="hs-identifier hs-var hs-var">cf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">URI -&gt; String
</span><span class="hs-identifier hs-var">uriScheme</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mqtt:&quot;</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runClient"><span class="hs-identifier hs-var">runClient</span></a></span><span>
</span><span id="line-179"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mqtts:&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runClientTLS"><span class="hs-identifier hs-var">runClientTLS</span></a></span><span>
</span><span id="line-180"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ws:&quot;</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">URI -&gt; Bool -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runWS"><span class="hs-identifier hs-var">runWS</span></a></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-181"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;wss:&quot;</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">URI -&gt; Bool -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runWS"><span class="hs-identifier hs-var">runWS</span></a></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-182"></span><span>             </span><span id="local-6989586621679113429"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113429"><span class="hs-identifier hs-var">us</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid URI scheme: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113429"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>      </span><span id="local-6989586621679113427"><span class="annot"><span class="annottext">a :: URIAuth
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">URIAuth
</span><span class="hs-identifier hs-var">nullURIAuth</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">URI -&gt; Maybe URIAuth
</span><span class="hs-identifier hs-var">uriAuthority</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679113425"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679113425"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113424"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679113424"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Maybe String, Maybe String)
</span><a href="#local-6989586621679113423"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">URIAuth -&gt; String
</span><span class="hs-identifier hs-var">uriUserInfo</span></span><span> </span><span class="annot"><span class="annottext">URIAuth
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>  </span><span id="local-6989586621679113422"><span class="annot"><span class="annottext">Maybe MQTTClient
</span><a href="#local-6989586621679113422"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; Int -&gt; IO a -&gt; IO (Maybe a)
</span><a href="Network.MQTT.Client.html#namedTimeout"><span class="hs-identifier hs-var">namedTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MQTT connect&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113451"><span class="hs-identifier hs-var">_connectTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">MQTTConfig -&gt; IO MQTTClient
</span><a href="#local-6989586621679113434"><span class="hs-identifier hs-var">cf</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTConfig
</span><a href="#local-6989586621679113462"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_connID :: String
</span><a href="Network.MQTT.Client.html#_connID"><span class="hs-identifier hs-var">Network.MQTT.Client._connID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall {p}. p -&gt; ShowS
</span><a href="#local-6989586621679113420"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolLevel
</span><a href="#local-6989586621679113458"><span class="hs-identifier hs-var">_protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">URI -&gt; String
</span><span class="hs-identifier hs-var">uriFragment</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>           </span><span class="annot"><span class="annottext">_hostname :: String
</span><a href="Network.MQTT.Client.html#_hostname"><span class="hs-identifier hs-var">_hostname</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">URIAuth -&gt; String
</span><span class="hs-identifier hs-var">uriRegName</span></span><span> </span><span class="annot"><span class="annottext">URIAuth
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_port :: Int
</span><a href="Network.MQTT.Client.html#_port"><span class="hs-identifier hs-var">_port</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall {a} {a}.
(Eq a, IsString a, Num a, Read a) =&gt;
String -&gt; a -&gt; a
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">URIAuth -&gt; String
</span><span class="hs-identifier hs-var">uriPort</span></span><span> </span><span class="annot"><span class="annottext">URIAuth
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">URI -&gt; String
</span><span class="hs-identifier hs-var">uriScheme</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>           </span><span class="annot"><span class="annottext">_username :: Maybe String
</span><a href="Network.MQTT.Client.html#_username"><span class="hs-identifier hs-var">Network.MQTT.Client._username</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679113425"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_password :: Maybe String
</span><a href="Network.MQTT.Client.html#_password"><span class="hs-identifier hs-var">Network.MQTT.Client._password</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679113424"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;connection to &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; timed out&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe MQTTClient
</span><a href="#local-6989586621679113422"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679113418"><span class="annot"><span class="annottext">port :: String -&gt; a -&gt; a
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;mqtt:&quot;</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1883</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;mqtts:&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">8883</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;ws:&quot;</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">80</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;wss:&quot;</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">443</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span id="local-6989586621679113388"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113388"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113388"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621679113420"><span class="annot"><span class="annottext">cid :: p -&gt; ShowS
</span><a href="#local-6989586621679113420"><span class="hs-identifier hs-var hs-var">cid</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><a href="#local-6989586621679113420"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679113381"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113381"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113381"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621679113420"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621679113423"><span class="annot"><span class="annottext">up :: String -&gt; (Maybe String, Maybe String)
</span><a href="#local-6989586621679113423"><span class="hs-identifier hs-var hs-var">up</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><a href="#local-6989586621679113423"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span id="local-6989586621679113374"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113374"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113372"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113372"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113371"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113371"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">break</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113374"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-207"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">unEscapeString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113372"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113371"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">unEscapeString</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113371"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | Set up and run a client from the given config.</span><span>
</span><span id="line-211"></span><span class="annot"><a href="Network.MQTT.Client.html#runClient"><span class="hs-identifier hs-type">runClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-212"></span><span id="runClient"><span class="annot"><span class="annottext">runClient :: MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runClient"><span class="hs-identifier hs-var hs-var">runClient</span></a></span></span><span> </span><span id="local-6989586621679113368"><span class="annot"><span class="annottext">cfg :: MQTTConfig
</span><a href="#local-6989586621679113368"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113354"><span id="local-6989586621679113355"><span id="local-6989586621679113356"><span id="local-6989586621679113357"><span id="local-6989586621679113358"><span id="local-6989586621679113359"><span id="local-6989586621679113360"><span id="local-6989586621679113361"><span id="local-6989586621679113362"><span id="local-6989586621679113363"><span id="local-6989586621679113364"><span id="local-6989586621679113365"><span id="local-6989586621679113366"><span id="local-6989586621679113367"><span class="annot"><span class="annottext">Bool
Int
String
[Property]
Maybe String
Maybe LastWill
ProtocolLevel
TLSSettings
MessageCallback
_pingPatience :: Int
_pingPeriod :: Int
_tlsSettings :: TLSSettings
_connectTimeout :: Int
_password :: Maybe String
_username :: Maybe String
_connID :: String
_port :: Int
_hostname :: String
_connProps :: [Property]
_protocol :: ProtocolLevel
_msgCB :: MessageCallback
_lwt :: Maybe LastWill
_cleanSession :: Bool
_pingPatience :: MQTTConfig -&gt; Int
_pingPeriod :: MQTTConfig -&gt; Int
_tlsSettings :: MQTTConfig -&gt; TLSSettings
_connectTimeout :: MQTTConfig -&gt; Int
_password :: MQTTConfig -&gt; Maybe String
_username :: MQTTConfig -&gt; Maybe String
_connID :: MQTTConfig -&gt; String
_port :: MQTTConfig -&gt; Int
_hostname :: MQTTConfig -&gt; String
_connProps :: MQTTConfig -&gt; [Property]
_protocol :: MQTTConfig -&gt; ProtocolLevel
_msgCB :: MQTTConfig -&gt; MessageCallback
_lwt :: MQTTConfig -&gt; Maybe LastWill
_cleanSession :: MQTTConfig -&gt; Bool
</span><a href="#local-6989586621679113354"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AppData -&gt; IO ()) -&gt; IO ()) -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#tcpCompat"><span class="hs-identifier hs-var">tcpCompat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ClientSettings -&gt; (AppData -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">runTCPClient</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ClientSettings
</span><span class="hs-identifier hs-var">clientSettings</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113361"><span class="hs-identifier hs-var">_port</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BCS.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113362"><span class="hs-identifier hs-var">_hostname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MQTTConfig
</span><a href="#local-6989586621679113368"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- | Set up and run a client connected via TLS.</span><span>
</span><span id="line-215"></span><span class="annot"><a href="Network.MQTT.Client.html#runClientTLS"><span class="hs-identifier hs-type">runClientTLS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-216"></span><span id="runClientTLS"><span class="annot"><span class="annottext">runClientTLS :: MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runClientTLS"><span class="hs-identifier hs-var hs-var">runClientTLS</span></a></span></span><span> </span><span id="local-6989586621679113351"><span class="annot"><span class="annottext">cfg :: MQTTConfig
</span><a href="#local-6989586621679113351"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113337"><span id="local-6989586621679113338"><span id="local-6989586621679113339"><span id="local-6989586621679113340"><span id="local-6989586621679113341"><span id="local-6989586621679113342"><span id="local-6989586621679113343"><span id="local-6989586621679113344"><span id="local-6989586621679113345"><span id="local-6989586621679113346"><span id="local-6989586621679113347"><span id="local-6989586621679113348"><span id="local-6989586621679113349"><span id="local-6989586621679113350"><span class="annot"><span class="annottext">Bool
Int
String
[Property]
Maybe String
Maybe LastWill
ProtocolLevel
TLSSettings
MessageCallback
_pingPatience :: Int
_pingPeriod :: Int
_tlsSettings :: TLSSettings
_connectTimeout :: Int
_password :: Maybe String
_username :: Maybe String
_connID :: String
_port :: Int
_hostname :: String
_connProps :: [Property]
_protocol :: ProtocolLevel
_msgCB :: MessageCallback
_lwt :: Maybe LastWill
_cleanSession :: Bool
_pingPatience :: MQTTConfig -&gt; Int
_pingPeriod :: MQTTConfig -&gt; Int
_tlsSettings :: MQTTConfig -&gt; TLSSettings
_connectTimeout :: MQTTConfig -&gt; Int
_password :: MQTTConfig -&gt; Maybe String
_username :: MQTTConfig -&gt; Maybe String
_connID :: MQTTConfig -&gt; String
_port :: MQTTConfig -&gt; Int
_hostname :: MQTTConfig -&gt; String
_connProps :: MQTTConfig -&gt; [Property]
_protocol :: MQTTConfig -&gt; ProtocolLevel
_msgCB :: MQTTConfig -&gt; MessageCallback
_lwt :: MQTTConfig -&gt; Maybe LastWill
_cleanSession :: MQTTConfig -&gt; Bool
</span><a href="#local-6989586621679113337"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AppData -&gt; IO ()) -&gt; IO ()) -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#tcpCompat"><span class="hs-identifier hs-var">tcpCompat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
TLSClientConfig -&gt; (AppData -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">runTLSClient</span></span><span> </span><span class="annot"><span class="annottext">TLSClientConfig
</span><a href="#local-6989586621679113336"><span class="hs-identifier hs-var">tlsConf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MQTTConfig
</span><a href="#local-6989586621679113351"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113336"><span class="annot"><span class="annottext">tlsConf :: TLSClientConfig
</span><a href="#local-6989586621679113336"><span class="hs-identifier hs-var hs-var">tlsConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; TLSClientConfig
</span><span class="hs-identifier hs-var">tlsClientConfig</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113344"><span class="hs-identifier hs-var">_port</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BCS.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113345"><span class="hs-identifier hs-var">_hostname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">tlsClientTLSSettings :: TLSSettings
</span><span class="hs-identifier hs-var">tlsClientTLSSettings</span></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679113339"><span class="hs-identifier hs-var">_tlsSettings</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Compatibility mechanisms for TCP Conduit bits.</span><span>
</span><span id="line-220"></span><span class="annot"><a href="Network.MQTT.Client.html#tcpCompat"><span class="hs-identifier hs-type">tcpCompat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AppData</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-221"></span><span id="tcpCompat"><span class="annot"><span class="annottext">tcpCompat :: ((AppData -&gt; IO ()) -&gt; IO ()) -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#tcpCompat"><span class="hs-identifier hs-var hs-var">tcpCompat</span></a></span></span><span> </span><span id="local-6989586621679113335"><span class="annot"><span class="annottext">(AppData -&gt; IO ()) -&gt; IO ()
</span><a href="#local-6989586621679113335"><span class="hs-identifier hs-var">mkconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MQTTConduit -&gt; IO ()) -&gt; IO ()) -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runMQTTConduit"><span class="hs-identifier hs-var">runMQTTConduit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a} {m :: * -&gt; *} {m :: * -&gt; *} {c} {t} {i} {o}.
(HasReadWrite a, MonadIO m, MonadIO m) =&gt;
((a -&gt; c) -&gt; t)
-&gt; ((ConduitT i ByteString m (), ConduitT ByteString o m ()) -&gt; c)
-&gt; t
</span><a href="#local-6989586621679113334"><span class="hs-identifier hs-var">adapt</span></a></span><span> </span><span class="annot"><span class="annottext">(AppData -&gt; IO ()) -&gt; IO ()
</span><a href="#local-6989586621679113335"><span class="hs-identifier hs-var">mkconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113334"><span class="annot"><span class="annottext">adapt :: ((a -&gt; c) -&gt; t)
-&gt; ((ConduitT i ByteString m (), ConduitT ByteString o m ()) -&gt; c)
-&gt; t
</span><a href="#local-6989586621679113334"><span class="hs-identifier hs-var hs-var">adapt</span></a></span></span><span> </span><span id="local-6989586621679113327"><span class="annot"><span class="annottext">(a -&gt; c) -&gt; t
</span><a href="#local-6989586621679113327"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679113326"><span class="annot"><span class="annottext">(ConduitT i ByteString m (), ConduitT ByteString o m ()) -&gt; c
</span><a href="#local-6989586621679113326"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; c) -&gt; t
</span><a href="#local-6989586621679113327"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ConduitT i ByteString m (), ConduitT ByteString o m ()) -&gt; c
</span><a href="#local-6989586621679113326"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall {ad} {m :: * -&gt; *} {m :: * -&gt; *} {i} {o}.
(HasReadWrite ad, MonadIO m, MonadIO m) =&gt;
ad -&gt; (ConduitT i ByteString m (), ConduitT ByteString o m ())
</span><a href="#local-6989586621679113325"><span class="hs-identifier hs-var">adaptor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621679113325"><span class="annot"><span class="annottext">adaptor :: ad -&gt; (ConduitT i ByteString m (), ConduitT ByteString o m ())
</span><a href="#local-6989586621679113325"><span class="hs-identifier hs-var hs-var">adaptor</span></a></span></span><span> </span><span id="local-6989586621679113317"><span class="annot"><span class="annottext">ad
</span><a href="#local-6989586621679113317"><span class="hs-identifier hs-var">ad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ad (m :: * -&gt; *) i.
(HasReadWrite ad, MonadIO m) =&gt;
ad -&gt; ConduitT i ByteString m ()
</span><span class="hs-identifier hs-var">appSource</span></span><span> </span><span class="annot"><span class="annottext">ad
</span><a href="#local-6989586621679113317"><span class="hs-identifier hs-var">ad</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall ad (m :: * -&gt; *) o.
(HasReadWrite ad, MonadIO m) =&gt;
ad -&gt; ConduitT ByteString o m ()
</span><span class="hs-identifier hs-var">appSink</span></span><span> </span><span class="annot"><span class="annottext">ad
</span><a href="#local-6989586621679113317"><span class="hs-identifier hs-var">ad</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Network.MQTT.Client.html#runWS"><span class="hs-identifier hs-type">runWS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">URI</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-226"></span><span id="runWS"><span class="annot"><span class="annottext">runWS :: URI -&gt; Bool -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runWS"><span class="hs-identifier hs-var hs-var">runWS</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">URI</span></span><span class="hs-special">{</span><span id="local-6989586621679113315"><span class="annot"><span class="annottext">String
uriPath :: URI -&gt; String
uriPath :: String
</span><span class="hs-identifier hs-var hs-var">uriPath</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113313"><span class="annot"><span class="annottext">String
uriQuery :: URI -&gt; String
uriQuery :: String
</span><span class="hs-identifier hs-var hs-var">uriQuery</span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679113311"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113311"><span class="hs-identifier hs-var">secure</span></a></span></span><span> </span><span id="local-6989586621679113310"><span class="annot"><span class="annottext">cfg :: MQTTConfig
</span><a href="#local-6989586621679113310"><span class="hs-identifier hs-var">cfg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113296"><span id="local-6989586621679113297"><span id="local-6989586621679113298"><span id="local-6989586621679113299"><span id="local-6989586621679113300"><span id="local-6989586621679113301"><span id="local-6989586621679113302"><span id="local-6989586621679113303"><span id="local-6989586621679113304"><span id="local-6989586621679113305"><span id="local-6989586621679113306"><span id="local-6989586621679113307"><span id="local-6989586621679113308"><span id="local-6989586621679113309"><span class="annot"><span class="annottext">Bool
Int
String
[Property]
Maybe String
Maybe LastWill
ProtocolLevel
TLSSettings
MessageCallback
_pingPatience :: Int
_pingPeriod :: Int
_tlsSettings :: TLSSettings
_connectTimeout :: Int
_password :: Maybe String
_username :: Maybe String
_connID :: String
_port :: Int
_hostname :: String
_connProps :: [Property]
_protocol :: ProtocolLevel
_msgCB :: MessageCallback
_lwt :: Maybe LastWill
_cleanSession :: Bool
_pingPatience :: MQTTConfig -&gt; Int
_pingPeriod :: MQTTConfig -&gt; Int
_tlsSettings :: MQTTConfig -&gt; TLSSettings
_connectTimeout :: MQTTConfig -&gt; Int
_password :: MQTTConfig -&gt; Maybe String
_username :: MQTTConfig -&gt; Maybe String
_connID :: MQTTConfig -&gt; String
_port :: MQTTConfig -&gt; Int
_hostname :: MQTTConfig -&gt; String
_connProps :: MQTTConfig -&gt; [Property]
_protocol :: MQTTConfig -&gt; ProtocolLevel
_msgCB :: MQTTConfig -&gt; MessageCallback
_lwt :: MQTTConfig -&gt; Maybe LastWill
_cleanSession :: MQTTConfig -&gt; Bool
</span><a href="#local-6989586621679113296"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="annottext">((MQTTConduit -&gt; IO ()) -&gt; IO ()) -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runMQTTConduit"><span class="hs-identifier hs-var">runMQTTConduit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {c} {t}. ((Connection -&gt; c) -&gt; t) -&gt; (MQTTConduit -&gt; c) -&gt; t
</span><a href="#local-6989586621679113295"><span class="hs-identifier hs-var">adapt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; String
-&gt; Int
-&gt; String
-&gt; ConnectionOptions
-&gt; Headers
-&gt; ClientApp ()
-&gt; IO ()
</span><a href="#local-6989586621679113294"><span class="hs-identifier hs-var">cf</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113311"><span class="hs-identifier hs-var">secure</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113304"><span class="hs-identifier hs-var">_hostname</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113303"><span class="hs-identifier hs-var">_port</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113293"><span class="hs-identifier hs-var">endpoint</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><span class="hs-identifier hs-var">WS.defaultConnectionOptions</span></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679113291"><span class="hs-identifier hs-var">hdrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MQTTConfig
</span><a href="#local-6989586621679113310"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621679113291"><span class="annot"><span class="annottext">hdrs :: Headers
</span><a href="#local-6989586621679113291"><span class="hs-identifier hs-var hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Sec-WebSocket-Protocol&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;mqtt&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621679113295"><span class="annot"><span class="annottext">adapt :: ((Connection -&gt; c) -&gt; t) -&gt; (MQTTConduit -&gt; c) -&gt; t
</span><a href="#local-6989586621679113295"><span class="hs-identifier hs-var hs-var">adapt</span></a></span></span><span> </span><span id="local-6989586621679113283"><span class="annot"><span class="annottext">(Connection -&gt; c) -&gt; t
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679113282"><span class="annot"><span class="annottext">MQTTConduit -&gt; c
</span><a href="#local-6989586621679113282"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Connection -&gt; c) -&gt; t
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTConduit -&gt; c
</span><a href="#local-6989586621679113282"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; MQTTConduit
</span><a href="#local-6989586621679113281"><span class="hs-identifier hs-var">adaptor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679113281"><span class="annot"><span class="annottext">adaptor :: Connection -&gt; MQTTConduit
</span><a href="#local-6989586621679113281"><span class="hs-identifier hs-var hs-var">adaptor</span></a></span></span><span> </span><span id="local-6989586621679113280"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113280"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; ConduitT () ByteString IO ()
</span><a href="#local-6989586621679113279"><span class="hs-identifier hs-var">wsSource</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113280"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; ConduitT ByteString Void IO ()
</span><a href="#local-6989586621679113278"><span class="hs-identifier hs-var">wsSink</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113280"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679113293"><span class="annot"><span class="annottext">endpoint :: String
</span><a href="#local-6989586621679113293"><span class="hs-identifier hs-var hs-var">endpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113315"><span class="hs-identifier hs-var">uriPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113313"><span class="hs-identifier hs-var">uriQuery</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621679113294"><span class="hs-identifier hs-type">cf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.ConnectionOptions</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.Headers</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.ClientApp</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679113294"><span class="annot"><span class="annottext">cf :: Bool
-&gt; String
-&gt; Int
-&gt; String
-&gt; ConnectionOptions
-&gt; Headers
-&gt; ClientApp ()
-&gt; IO ()
</span><a href="#local-6989586621679113294"><span class="hs-identifier hs-var hs-var">cf</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
String
-&gt; Int
-&gt; String
-&gt; ConnectionOptions
-&gt; Headers
-&gt; ClientApp a
-&gt; IO a
</span><span class="hs-identifier hs-var">WS.runClientWith</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621679113294"><span class="hs-identifier hs-var">cf</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Int
-&gt; String
-&gt; ConnectionOptions
-&gt; Headers
-&gt; ClientApp ()
-&gt; IO ()
</span><a href="#local-6989586621679113275"><span class="hs-identifier hs-var">runWSS</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><a href="#local-6989586621679113279"><span class="hs-identifier hs-type">wsSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BCS.ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679113279"><span class="annot"><span class="annottext">wsSource :: Connection -&gt; ConduitT () ByteString IO ()
</span><a href="#local-6989586621679113279"><span class="hs-identifier hs-var hs-var">wsSource</span></a></span></span><span> </span><span id="local-6989586621679113274"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113274"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>      </span><span id="local-6989586621679113273"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113273"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. WebSocketsData a =&gt; Connection -&gt; IO a
</span><span class="hs-identifier hs-var">WS.receiveData</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113274"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BCS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113273"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) o i. Monad m =&gt; o -&gt; ConduitT i o m ()
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113273"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="#local-6989586621679113278"><span class="hs-identifier hs-type">wsSink</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BCS.ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621679113278"><span class="annot"><span class="annottext">wsSink :: Connection -&gt; ConduitT ByteString Void IO ()
</span><a href="#local-6989586621679113278"><span class="hs-identifier hs-var hs-var">wsSink</span></a></span></span><span> </span><span id="local-6989586621679113270"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113270"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113269"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113269"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. WebSocketsData a =&gt; Connection -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">WS.sendBinaryData</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113270"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113269"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; ConduitT ByteString Void IO ()
</span><a href="#local-6989586621679113278"><span class="hs-identifier hs-var">wsSink</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113270"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i o. Monad m =&gt; ConduitT i o m (Maybe i)
</span><span class="hs-identifier hs-var">await</span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621679113275"><span class="hs-identifier hs-type">runWSS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.ConnectionOptions</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.Headers</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WS.ClientApp</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679113275"><span class="annot"><span class="annottext">runWSS :: String
-&gt; Int
-&gt; String
-&gt; ConnectionOptions
-&gt; Headers
-&gt; ClientApp ()
-&gt; IO ()
</span><a href="#local-6989586621679113275"><span class="hs-identifier hs-var hs-var">runWSS</span></a></span></span><span> </span><span id="local-6989586621679113266"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113266"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span id="local-6989586621679113265"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113265"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span id="local-6989586621679113264"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113264"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679113263"><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621679113263"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span id="local-6989586621679113262"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679113262"><span class="hs-identifier hs-var">hdrs'</span></a></span></span><span> </span><span id="local-6989586621679113261"><span class="annot"><span class="annottext">ClientApp ()
</span><a href="#local-6989586621679113261"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113258"><span class="annot"><span class="annottext">connectionParams :: ConnectionParams
</span><a href="#local-6989586621679113258"><span class="hs-identifier hs-var hs-var">connectionParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConnectionParams</span></span><span>
</span><span id="line-251"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connectionHostname :: String
</span><span class="hs-identifier hs-var">connectionHostname</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113266"><span class="hs-identifier hs-var">host</span></a></span><span>
</span><span id="line-252"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connectionPort :: PortNumber
</span><span class="hs-identifier hs-var">connectionPort</span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113265"><span class="hs-identifier hs-var">port</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connectionUseSecure :: Maybe TLSSettings
</span><span class="hs-identifier hs-var">connectionUseSecure</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679113298"><span class="hs-identifier hs-var">_tlsSettings</span></a></span><span>
</span><span id="line-254"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connectionUseSocks :: Maybe ProxySettings
</span><span class="hs-identifier hs-var">connectionUseSocks</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>      </span><span id="local-6989586621679113251"><span class="annot"><span class="annottext">ConnectionContext
</span><a href="#local-6989586621679113251"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ConnectionContext
</span><span class="hs-identifier hs-var">initConnectionContext</span></span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">E.bracket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionContext -&gt; ConnectionParams -&gt; IO Connection
</span><span class="hs-identifier hs-var">connectTo</span></span><span> </span><span class="annot"><span class="annottext">ConnectionContext
</span><a href="#local-6989586621679113251"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionParams
</span><a href="#local-6989586621679113258"><span class="hs-identifier hs-var">connectionParams</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><span class="hs-identifier hs-var">connectionClose</span></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113249"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113249"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>            </span><span id="local-6989586621679113248"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679113248"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ByteString) -&gt; (Maybe ByteString -&gt; IO ()) -&gt; IO Stream
</span><span class="hs-identifier hs-var">makeStream</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; IO (Maybe ByteString)
</span><a href="#local-6989586621679113247"><span class="hs-identifier hs-var">reader</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113249"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Maybe ByteString -&gt; IO ()
</span><a href="#local-6989586621679113246"><span class="hs-identifier hs-var">writer</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113249"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>            </span><span class="annot"><span class="annottext">forall a.
Stream
-&gt; String
-&gt; String
-&gt; ConnectionOptions
-&gt; Headers
-&gt; ClientApp a
-&gt; IO a
</span><span class="hs-identifier hs-var">WS.runClientWithStream</span></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679113248"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113266"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113264"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621679113263"><span class="hs-identifier hs-var">options</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679113262"><span class="hs-identifier hs-var">hdrs'</span></a></span><span> </span><span class="annot"><span class="annottext">ClientApp ()
</span><a href="#local-6989586621679113261"><span class="hs-identifier hs-var">app</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>          </span><span id="local-6989586621679113247"><span class="annot"><span class="annottext">reader :: Connection -&gt; IO (Maybe ByteString)
</span><a href="#local-6989586621679113247"><span class="hs-identifier hs-var hs-var">reader</span></a></span></span><span> </span><span id="local-6989586621679113240"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113240"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>            </span><span class="annot"><span class="annottext">forall a. IO a -&gt; (IOError -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">catchIOError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ByteString
</span><span class="hs-identifier hs-var">connectionGetChunk</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113240"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113238"><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679113238"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; Bool
</span><span class="hs-identifier hs-var">isEOFError</span></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679113238"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679113238"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>          </span><span id="local-6989586621679113246"><span class="annot"><span class="annottext">writer :: Connection -&gt; Maybe ByteString -&gt; IO ()
</span><a href="#local-6989586621679113246"><span class="hs-identifier hs-var hs-var">writer</span></a></span></span><span> </span><span id="local-6989586621679113235"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113235"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">connectionPut</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679113235"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BC.toStrict</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span id="local-6989586621679114176"><span class="annot"><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-type">mqttFail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679114176"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-271"></span><span id="mqttFail"><span class="annot"><span class="annottext">mqttFail :: forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var hs-var">mqttFail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">E.throw</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; MQTTException
</span><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier hs-var">MQTTException</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- A couple async utilities to get our stuff named.</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span id="local-6989586621679114080"><span class="annot"><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-type">namedAsync</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679114080"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="annot"><a href="#local-6989586621679114080"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-276"></span><span id="namedAsync"><span class="annot"><span class="annottext">namedAsync :: forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var hs-var">namedAsync</span></a></span></span><span> </span><span id="local-6989586621679113226"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113226"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679113225"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679113225"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO (Async a)
</span><span class="hs-identifier hs-var">async</span></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679113225"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679113224"><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679113224"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">labelThread</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Async a -&gt; ThreadId
</span><span class="hs-identifier hs-var">asyncThreadId</span></span><span> </span><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679113224"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113226"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679113224"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span id="local-6989586621679114169"><span class="annot"><a href="Network.MQTT.Client.html#namedTimeout"><span class="hs-identifier hs-type">namedTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679114169"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679114169"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-279"></span><span id="namedTimeout"><span class="annot"><span class="annottext">namedTimeout :: forall a. String -&gt; Int -&gt; IO a -&gt; IO (Maybe a)
</span><a href="Network.MQTT.Client.html#namedTimeout"><span class="hs-identifier hs-var hs-var">namedTimeout</span></a></span></span><span> </span><span id="local-6989586621679113221"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113221"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679113220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113220"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621679113219"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679113219"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; IO a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">timeout</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113220"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ThreadId
</span><span class="hs-identifier hs-var">myThreadId</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679113218"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679113218"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">labelThread</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679113218"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113221"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679113219"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | MQTTConduit provides a source and sink for data as used by 'runMQTTConduit'.</span><span>
</span><span id="line-282"></span><span class="hs-keyword">type</span><span> </span><span id="MQTTConduit"><span class="annot"><a href="Network.MQTT.Client.html#MQTTConduit"><span class="hs-identifier hs-var">MQTTConduit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BCS.ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BCS.ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | Set up and run a client with a conduit context function.</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- The provided action calls another IO action with a 'MQTTConduit' as a</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- parameter.  It is expected that this action will manage the</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- lifecycle of the conduit source/sink on behalf of the client.</span><span>
</span><span id="line-289"></span><span class="annot"><a href="Network.MQTT.Client.html#runMQTTConduit"><span class="hs-identifier hs-type">runMQTTConduit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConduit"><span class="hs-identifier hs-type">MQTTConduit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ an action providing an 'MQTTConduit' in an execution context</span><span>
</span><span id="line-290"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span> </span><span class="hs-comment">-- ^ the 'MQTTConfig'</span><span>
</span><span id="line-291"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-292"></span><span id="runMQTTConduit"><span class="annot"><span class="annottext">runMQTTConduit :: ((MQTTConduit -&gt; IO ()) -&gt; IO ()) -&gt; MQTTConfig -&gt; IO MQTTClient
</span><a href="Network.MQTT.Client.html#runMQTTConduit"><span class="hs-identifier hs-var hs-var">runMQTTConduit</span></a></span></span><span> </span><span id="local-6989586621679113217"><span class="annot"><span class="annottext">(MQTTConduit -&gt; IO ()) -&gt; IO ()
</span><a href="#local-6989586621679113217"><span class="hs-identifier hs-var">mkconn</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTConfig"><span class="hs-identifier hs-type">MQTTConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113203"><span id="local-6989586621679113204"><span id="local-6989586621679113205"><span id="local-6989586621679113206"><span id="local-6989586621679113207"><span id="local-6989586621679113208"><span id="local-6989586621679113209"><span id="local-6989586621679113210"><span id="local-6989586621679113211"><span id="local-6989586621679113212"><span id="local-6989586621679113213"><span id="local-6989586621679113214"><span id="local-6989586621679113215"><span id="local-6989586621679113216"><span class="annot"><span class="annottext">Bool
Int
String
[Property]
Maybe String
Maybe LastWill
ProtocolLevel
TLSSettings
MessageCallback
_pingPatience :: Int
_pingPeriod :: Int
_tlsSettings :: TLSSettings
_connectTimeout :: Int
_password :: Maybe String
_username :: Maybe String
_connID :: String
_port :: Int
_hostname :: String
_connProps :: [Property]
_protocol :: ProtocolLevel
_msgCB :: MessageCallback
_lwt :: Maybe LastWill
_cleanSession :: Bool
_pingPatience :: MQTTConfig -&gt; Int
_pingPeriod :: MQTTConfig -&gt; Int
_tlsSettings :: MQTTConfig -&gt; TLSSettings
_connectTimeout :: MQTTConfig -&gt; Int
_password :: MQTTConfig -&gt; Maybe String
_username :: MQTTConfig -&gt; Maybe String
_connID :: MQTTConfig -&gt; String
_port :: MQTTConfig -&gt; Int
_hostname :: MQTTConfig -&gt; String
_connProps :: MQTTConfig -&gt; [Property]
_protocol :: MQTTConfig -&gt; ProtocolLevel
_msgCB :: MQTTConfig -&gt; MessageCallback
_lwt :: MQTTConfig -&gt; Maybe LastWill
_cleanSession :: MQTTConfig -&gt; Bool
</span><a href="#local-6989586621679113203"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621679113202"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679113202"><span class="hs-identifier hs-var">_ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO (TChan a)
</span><span class="hs-identifier hs-var">newTChanIO</span></span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621679113201"><span class="annot"><span class="annottext">TVar Word16
</span><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">_pktID</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621679113200"><span class="annot"><span class="annottext">TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
</span><a href="#local-6989586621679113200"><span class="hs-identifier hs-var">_acks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621679113199"><span class="annot"><span class="annottext">Map Word16 PublishRequest
</span><a href="#local-6989586621679113199"><span class="hs-identifier hs-var">_inflight</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; NominalDiffTime -&gt; IO (Map k a)
</span><a href="Data.Map.Strict.Decaying.html#new"><span class="hs-identifier hs-var">Decaying.new</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">60</span></span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621679113197"><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679113197"><span class="hs-identifier hs-var">_st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Starting"><span class="hs-identifier hs-var">Starting</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621679113196"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679113196"><span class="hs-identifier hs-var">_ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-299"></span><span>  </span><span id="local-6989586621679113195"><span class="annot"><span class="annottext">TVar (Map Topic Word16)
</span><a href="#local-6989586621679113195"><span class="hs-identifier hs-var">_outA</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679113194"><span class="annot"><span class="annottext">TVar (Map Word16 Topic)
</span><a href="#local-6989586621679113194"><span class="hs-identifier hs-var">_inA</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621679113193"><span class="annot"><span class="annottext">TVar ConnACKFlags
</span><a href="#local-6989586621679113193"><span class="hs-identifier hs-var">_connACKFlags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SessionReuse -&gt; ConnACKRC -&gt; [Property] -&gt; ConnACKFlags
</span><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-var">ConnACKFlags</span></a></span><span> </span><span class="annot"><span class="annottext">SessionReuse
</span><a href="Network.MQTT.Types.html#NewSession"><span class="hs-identifier hs-var">NewSession</span></a></span><span> </span><span class="annot"><span class="annottext">ConnACKRC
</span><a href="Network.MQTT.Types.html#ConnUnspecifiedError"><span class="hs-identifier hs-var">ConnUnspecifiedError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679113189"><span class="annot"><span class="annottext">Map ByteString MessageCallback
</span><a href="#local-6989586621679113189"><span class="hs-identifier hs-var">_corr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; NominalDiffTime -&gt; IO (Map k a)
</span><a href="Data.Map.Strict.Decaying.html#new"><span class="hs-identifier hs-var">Decaying.new</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">600</span></span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679113188"><span class="annot"><span class="annottext">MVar (IO ())
</span><a href="#local-6989586621679113188"><span class="hs-identifier hs-var">_cbM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621679113187"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679113187"><span class="hs-identifier hs-var">_cbHandle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113186"><span class="annot"><span class="annottext">_cb :: MessageCallback
</span><a href="#local-6989586621679113186"><span class="hs-identifier hs-var hs-var">_cb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679113214"><span class="hs-identifier hs-var">_msgCB</span></a></span><span>
</span><span id="line-306"></span><span>      </span><span id="local-6989586621679113185"><span class="annot"><span class="annottext">cli :: MQTTClient
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var hs-var">cli</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cb :: MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
</span><a href="#local-6989586621679113186"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621679113184"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MQTT clientThread&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; IO ()
</span><a href="#local-6989586621679113183"><span class="hs-identifier hs-var">clientThread</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var">cli</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679113182"><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113182"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; Async () -&gt; STM ConnState
</span><a href="#local-6989586621679113181"><span class="hs-identifier hs-var">waitForLaunch</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var">cli</span></a></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113182"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Disconnected"><span class="hs-identifier hs-var">Disconnected</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var">cli</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var">cli</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679113183"><span class="annot"><span class="annottext">clientThread :: MQTTClient -&gt; IO ()
</span><a href="#local-6989586621679113183"><span class="hs-identifier hs-var hs-var">clientThread</span></a></span></span><span> </span><span id="local-6989586621679113179"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">cli</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">E.finally</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679113177"><span class="hs-identifier hs-var">connectAndRun</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679113176"><span class="hs-identifier hs-var">markDisco</span></a></span><span>
</span><span id="line-319"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-320"></span><span>        </span><span id="local-6989586621679113177"><span class="annot"><span class="annottext">connectAndRun :: IO ()
</span><a href="#local-6989586621679113177"><span class="hs-identifier hs-var hs-var">connectAndRun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MQTTConduit -&gt; IO ()) -&gt; IO ()
</span><a href="#local-6989586621679113217"><span class="hs-identifier hs-var">mkconn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679113173"><span class="annot"><span class="annottext">MQTTConduit
</span><a href="#local-6989586621679113173"><span class="hs-identifier hs-var">ad</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {b} {a} {a}.
Monad m =&gt;
b -&gt; (a, ConduitT ByteString Void m a) -&gt; m b
</span><a href="#local-6989586621679113172"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">cli</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTConduit
</span><a href="#local-6989586621679113173"><span class="hs-identifier hs-var">ad</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">MQTTConduit -&gt; MQTTClient -&gt; IO ()
</span><a href="#local-6989586621679113171"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTConduit
</span><a href="#local-6989586621679113173"><span class="hs-identifier hs-var">ad</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621679113176"><span class="annot"><span class="annottext">markDisco :: IO ()
</span><a href="#local-6989586621679113176"><span class="hs-identifier hs-var hs-var">markDisco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>          </span><span id="local-6989586621679113164"><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113164"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; TVar ConnState
</span><a href="Network.MQTT.Client.html#_st"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">cli</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113164"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Starting"><span class="hs-identifier hs-var">Starting</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113164"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span>
</span><span id="line-324"></span><span>          </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; TVar ConnState
</span><a href="Network.MQTT.Client.html#_st"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">cli</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Disconnected"><span class="hs-identifier hs-var">Disconnected</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679113172"><span class="annot"><span class="annottext">start :: b -&gt; (a, ConduitT ByteString Void m a) -&gt; m b
</span><a href="#local-6989586621679113172"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679113149"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679113149"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113148"><span class="annot"><span class="annottext">ConduitT ByteString Void m a
</span><a href="#local-6989586621679113148"><span class="hs-identifier hs-var">sink</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ConduitT () Void m r -&gt; m r
</span><span class="hs-identifier hs-var">runConduit</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113144"><span class="annot"><span class="annottext">req :: ConnectRequest
</span><a href="#local-6989586621679113144"><span class="hs-identifier hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnectRequest
</span><a href="Network.MQTT.Types.html#connectRequest"><span class="hs-identifier hs-var">connectRequest</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_connID :: ByteString
</span><a href="Network.MQTT.Types.html#_connID"><span class="hs-identifier hs-var">T._connID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BC.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113209"><span class="hs-identifier hs-var">_connID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>                                 </span><span class="annot"><span class="annottext">_lastWill :: Maybe LastWill
</span><a href="Network.MQTT.Types.html#_lastWill"><span class="hs-identifier hs-var">T._lastWill</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Maybe LastWill
</span><a href="#local-6989586621679113215"><span class="hs-identifier hs-var">_lwt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>                                 </span><span class="annot"><span class="annottext">_username :: Maybe ByteString
</span><a href="Network.MQTT.Types.html#_username"><span class="hs-identifier hs-var">T._username</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BC.pack</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679113208"><span class="hs-identifier hs-var">_username</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>                                 </span><span class="annot"><span class="annottext">_password :: Maybe ByteString
</span><a href="Network.MQTT.Types.html#_password"><span class="hs-identifier hs-var">T._password</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BC.pack</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679113207"><span class="hs-identifier hs-var">_password</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>                                 </span><span class="annot"><span class="annottext">_cleanSession :: Bool
</span><a href="Network.MQTT.Types.html#_cleanSession"><span class="hs-identifier hs-var">T._cleanSession</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113216"><span class="hs-identifier hs-var">_cleanSession</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-333"></span><span>                                 </span><span class="annot"><span class="annottext">_connProperties :: [Property]
</span><a href="Network.MQTT.Types.html#_connProperties"><span class="hs-identifier hs-var">T._connProperties</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">_connProps</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) o i. Monad m =&gt; o -&gt; ConduitT i o m ()
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. ByteMe a =&gt; ProtocolLevel -&gt; a -&gt; ByteString
</span><a href="Network.MQTT.Types.html#toByteString"><span class="hs-identifier hs-var">toByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolLevel
</span><a href="#local-6989586621679113213"><span class="hs-identifier hs-var">_protocol</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectRequest
</span><a href="#local-6989586621679113144"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">ConduitT ByteString Void m a
</span><a href="#local-6989586621679113148"><span class="hs-identifier hs-var">sink</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679113149"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621679113171"><span class="annot"><span class="annottext">run :: MQTTConduit -&gt; MQTTClient -&gt; IO ()
</span><a href="#local-6989586621679113171"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113126"><span class="annot"><span class="annottext">ConduitT () ByteString IO ()
</span><a href="#local-6989586621679113126"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113125"><span class="annot"><span class="annottext">ConduitT ByteString Void IO ()
</span><a href="#local-6989586621679113125"><span class="hs-identifier hs-var">sink</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113124"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679113124"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113111"><span id="local-6989586621679113112"><span id="local-6989586621679113113"><span id="local-6989586621679113114"><span id="local-6989586621679113115"><span id="local-6989586621679113116"><span id="local-6989586621679113117"><span id="local-6989586621679113118"><span id="local-6989586621679113119"><span id="local-6989586621679113120"><span id="local-6989586621679113121"><span id="local-6989586621679113122"><span id="local-6989586621679113123"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679113111"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>      </span><span id="local-6989586621679113110"><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679113110"><span class="hs-identifier hs-var">pch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO (TChan a)
</span><span class="hs-identifier hs-var">newTChanIO</span></span><span>
</span><span id="line-340"></span><span>      </span><span id="local-6989586621679113109"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113109"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MQTT out&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679113108"><span class="hs-identifier hs-var">onceConnected</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679113107"><span class="hs-identifier hs-var">processOut</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span id="local-6989586621679113106"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113106"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MQTT ping&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679113108"><span class="hs-identifier hs-var">onceConnected</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {b}. IO b
</span><a href="#local-6989586621679113105"><span class="hs-identifier hs-var">doPing</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span id="local-6989586621679113104"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113104"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MQTT watchdog&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {b}. TChan a -&gt; IO b
</span><a href="#local-6989586621679113103"><span class="hs-identifier hs-var">watchdog</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679113110"><span class="hs-identifier hs-var">pch</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621679113102"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113102"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MQTT in&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan Bool -&gt; IO ()
</span><a href="#local-6989586621679113101"><span class="hs-identifier hs-var">doSrc</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679113110"><span class="hs-identifier hs-var">pch</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. [Async a] -&gt; IO (Async a, a)
</span><span class="hs-identifier hs-var">waitAnyCancel</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113109"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113106"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113104"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113102"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621679113101"><span class="annot"><span class="annottext">doSrc :: TChan Bool -&gt; IO ()
</span><a href="#local-6989586621679113101"><span class="hs-identifier hs-var hs-var">doSrc</span></a></span></span><span> </span><span id="local-6989586621679113091"><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679113091"><span class="hs-identifier hs-var">pch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ConduitT () Void m r -&gt; m r
</span><span class="hs-identifier hs-var">runConduit</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConduitT () ByteString IO ()
</span><a href="#local-6989586621679113126"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-349"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(AttoparsecInput a, MonadThrow m) =&gt;
Parser a b -&gt; ConduitT a (PositionRange, b) m ()
</span><span class="hs-identifier hs-var">conduitParser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolLevel -&gt; Parser MQTTPkt
</span><a href="Network.MQTT.Types.html#parsePacket"><span class="hs-identifier hs-var">parsePacket</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolLevel
</span><a href="#local-6989586621679113213"><span class="hs-identifier hs-var">_protocol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a o.
Monad m =&gt;
(a -&gt; m ()) -&gt; ConduitT a o m ()
</span><span class="hs-identifier hs-var">C.mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PositionRange
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113088"><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679113088"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; TChan Bool -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#dispatch"><span class="hs-identifier hs-var">dispatch</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113124"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679113091"><span class="hs-identifier hs-var">pch</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679113088"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621679113108"><span class="annot"><span class="annottext">onceConnected :: IO ()
</span><a href="#local-6989586621679113108"><span class="hs-identifier hs-var hs-var">onceConnected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; STM ()
</span><span class="hs-identifier hs-var">check</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679113118"><span class="hs-identifier hs-var">_st</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>        </span><span id="local-6989586621679113107"><span class="annot"><span class="annottext">processOut :: IO ()
</span><a href="#local-6989586621679113107"><span class="hs-identifier hs-var hs-var">processOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ConduitT () Void m r -&gt; m r
</span><span class="hs-identifier hs-var">runConduit</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a i. Monad m =&gt; m a -&gt; ConduitT i a m ()
</span><span class="hs-identifier hs-var">C.repeatM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113124"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679113123"><span class="hs-identifier hs-var">_ch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; ConduitT a b m ()
</span><span class="hs-identifier hs-var">C.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. ByteMe a =&gt; ProtocolLevel -&gt; a -&gt; ByteString
</span><a href="Network.MQTT.Types.html#toByteString"><span class="hs-identifier hs-var">toByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolLevel
</span><a href="#local-6989586621679113213"><span class="hs-identifier hs-var">_protocol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">ConduitT ByteString Void IO ()
</span><a href="#local-6989586621679113125"><span class="hs-identifier hs-var">sink</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>        </span><span id="local-6989586621679113105"><span class="annot"><span class="annottext">doPing :: IO b
</span><a href="#local-6989586621679113105"><span class="hs-identifier hs-var hs-var">doPing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113204"><span class="hs-identifier hs-var">_pingPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var">sendPacketIO</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113124"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="Network.MQTT.Types.html#PingPkt"><span class="hs-identifier hs-var">PingPkt</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>        </span><span id="local-6989586621679113103"><span class="annot"><span class="annottext">watchdog :: TChan a -&gt; IO b
</span><a href="#local-6989586621679113103"><span class="hs-identifier hs-var hs-var">watchdog</span></a></span></span><span> </span><span id="local-6989586621679113058"><span class="annot"><span class="annottext">TChan a
</span><a href="#local-6989586621679113058"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>          </span><span id="local-6989586621679113057"><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679113057"><span class="hs-identifier hs-var">toch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (TVar Bool)
</span><span class="hs-identifier hs-var">registerDelay</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113203"><span class="hs-identifier hs-var">_pingPatience</span></a></span><span>
</span><span id="line-363"></span><span>          </span><span id="local-6989586621679113056"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113056"><span class="hs-identifier hs-var">timedOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; STM ()
</span><span class="hs-identifier hs-var">check</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679113057"><span class="hs-identifier hs-var">toch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; STM a -&gt; STM a
</span><span class="hs-operator hs-var">`orElse`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan a
</span><a href="#local-6989586621679113058"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113056"><span class="hs-identifier hs-var">timedOut</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; MQTTClient -&gt; e -&gt; IO ()
</span><a href="Network.MQTT.Client.html#killConn"><span class="hs-identifier hs-var">killConn</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113124"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTException
</span><a href="Network.MQTT.Client.html#Timeout"><span class="hs-identifier hs-var">Timeout</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621679113181"><span class="annot"><span class="annottext">waitForLaunch :: MQTTClient -&gt; Async () -&gt; STM ConnState
</span><a href="#local-6989586621679113181"><span class="hs-identifier hs-var hs-var">waitForLaunch</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113037"><span id="local-6989586621679113038"><span id="local-6989586621679113039"><span id="local-6989586621679113040"><span id="local-6989586621679113041"><span id="local-6989586621679113042"><span id="local-6989586621679113043"><span id="local-6989586621679113044"><span id="local-6989586621679113045"><span id="local-6989586621679113046"><span id="local-6989586621679113047"><span id="local-6989586621679113048"><span id="local-6989586621679113049"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679113037"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679113036"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113036"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679113043"><span class="hs-identifier hs-var">_ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679113036"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>      </span><span id="local-6989586621679113035"><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113035"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679113044"><span class="hs-identifier hs-var">_st</span></a></span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113035"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Starting"><span class="hs-identifier hs-var">Starting</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. STM a
</span><span class="hs-identifier hs-var">retry</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679113035"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- | Wait for a client to terminate its connection.</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- An exception is thrown if the client didn't terminate expectedly.</span><span>
</span><span id="line-373"></span><span class="annot"><a href="Network.MQTT.Client.html#waitForClient"><span class="hs-identifier hs-type">waitForClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span id="waitForClient"><span class="annot"><span class="annottext">waitForClient :: MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#waitForClient"><span class="hs-identifier hs-var hs-var">waitForClient</span></a></span></span><span> </span><span id="local-6989586621679113034"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679113034"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113021"><span id="local-6989586621679113022"><span id="local-6989586621679113023"><span id="local-6989586621679113024"><span id="local-6989586621679113025"><span id="local-6989586621679113026"><span id="local-6989586621679113027"><span id="local-6989586621679113028"><span id="local-6989586621679113029"><span id="local-6989586621679113030"><span id="local-6989586621679113031"><span id="local-6989586621679113032"><span id="local-6989586621679113033"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679113021"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">E.finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#stopCallbackThread"><span class="hs-identifier hs-var">stopCallbackThread</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113034"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679113027"><span class="hs-identifier hs-var">_ct</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; ConnState -&gt; STM (Maybe SomeException)
</span><a href="Network.MQTT.Client.html#stateX"><span class="hs-identifier hs-var">stateX</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679113034"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Stops the client and closes the connection without sending a DISCONNECT</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- message to the broker. This will cause the last-will message to be delivered</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- by the broker if it has been defined.</span><span>
</span><span id="line-381"></span><span class="annot"><a href="Network.MQTT.Client.html#stopClient"><span class="hs-identifier hs-type">stopClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span id="stopClient"><span class="annot"><span class="annottext">stopClient :: MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#stopClient"><span class="hs-identifier hs-var hs-var">stopClient</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679113004"><span id="local-6989586621679113005"><span id="local-6989586621679113006"><span id="local-6989586621679113007"><span id="local-6989586621679113008"><span id="local-6989586621679113009"><span id="local-6989586621679113010"><span id="local-6989586621679113011"><span id="local-6989586621679113012"><span id="local-6989586621679113013"><span id="local-6989586621679113014"><span id="local-6989586621679113015"><span id="local-6989586621679113016"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679113004"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO ()
</span><span class="hs-identifier hs-var">cancel</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679113010"><span class="hs-identifier hs-var">_ct</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO ()
</span><span class="hs-identifier hs-var">cancel</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679113004"><span class="hs-identifier hs-var">_cbHandle</span></a></span><span>
</span><span id="line-385"></span><span>  </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679113011"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><a href="Network.MQTT.Client.html#stateX"><span class="hs-identifier hs-type">stateX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#ConnState"><span class="hs-identifier hs-type">ConnState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span id="stateX"><span class="annot"><span class="annottext">stateX :: MQTTClient -&gt; ConnState -&gt; STM (Maybe SomeException)
</span><a href="Network.MQTT.Client.html#stateX"><span class="hs-identifier hs-var hs-var">stateX</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112991"><span id="local-6989586621679112992"><span id="local-6989586621679112993"><span id="local-6989586621679112994"><span id="local-6989586621679112995"><span id="local-6989586621679112996"><span id="local-6989586621679112997"><span id="local-6989586621679112998"><span id="local-6989586621679112999"><span id="local-6989586621679113000"><span id="local-6989586621679113001"><span id="local-6989586621679113002"><span id="local-6989586621679113003"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112991"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112990"><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679112990"><span class="hs-identifier hs-var">want</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnState -&gt; Maybe SomeException
</span><a href="#local-6989586621679112989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112998"><span class="hs-identifier hs-var">_st</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621679112987"><span class="annot"><span class="annottext">je :: String -&gt; Maybe SomeException
</span><a href="#local-6989586621679112987"><span class="hs-identifier hs-var hs-var">je</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">E.toException</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; MQTTException
</span><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier hs-var">MQTTException</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><a href="#local-6989586621679112989"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#ConnState"><span class="hs-identifier hs-type">ConnState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621679112989"><span class="annot"><span class="annottext">f :: ConnState -&gt; Maybe SomeException
</span><a href="#local-6989586621679112989"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679112990"><span class="hs-identifier hs-var">want</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe SomeException
</span><a href="#local-6989586621679112987"><span class="hs-identifier hs-var">je</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpectedly connected&quot;</span></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><a href="#local-6989586621679112989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679112990"><span class="hs-identifier hs-var">want</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe SomeException
</span><a href="#local-6989586621679112987"><span class="hs-identifier hs-var">je</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpectedly stopped&quot;</span></span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><a href="#local-6989586621679112989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Disconnected"><span class="hs-identifier hs-var">Disconnected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe SomeException
</span><a href="#local-6989586621679112987"><span class="hs-identifier hs-var">je</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;disconnected&quot;</span></span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><a href="#local-6989586621679112989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Starting"><span class="hs-identifier hs-var">Starting</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe SomeException
</span><a href="#local-6989586621679112987"><span class="hs-identifier hs-var">je</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;died while starting&quot;</span></span><span>
</span><span id="line-398"></span><span>    </span><span class="annot"><a href="#local-6989586621679112989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#DiscoErr"><span class="hs-identifier hs-type">DiscoErr</span></a></span><span> </span><span id="local-6989586621679112985"><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112985"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">E.toException</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DisconnectRequest -&gt; MQTTException
</span><a href="Network.MQTT.Client.html#Discod"><span class="hs-identifier hs-var">Discod</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112985"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="#local-6989586621679112989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#ConnErr"><span class="hs-identifier hs-type">ConnErr</span></a></span><span> </span><span id="local-6989586621679112983"><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112983"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe SomeException
</span><a href="#local-6989586621679112987"><span class="hs-identifier hs-var">je</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112983"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-keyword">data</span><span> </span><span id="MQTTException"><span class="annot"><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier hs-var">MQTTException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Timeout"><span class="annot"><a href="Network.MQTT.Client.html#Timeout"><span class="hs-identifier hs-var">Timeout</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="BadData"><span class="annot"><a href="Network.MQTT.Client.html#BadData"><span class="hs-identifier hs-var">BadData</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Discod"><span class="annot"><a href="Network.MQTT.Client.html#Discod"><span class="hs-identifier hs-var">Discod</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#DisconnectRequest"><span class="hs-identifier hs-type">DisconnectRequest</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="MQTTException"><span class="annot"><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier hs-var">MQTTException</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span id="local-6989586621679112976"><span id="local-6989586621679112980"><span class="annot"><span class="annottext">MQTTException -&gt; MQTTException -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: MQTTException -&gt; MQTTException -&gt; Bool
$c/= :: MQTTException -&gt; MQTTException -&gt; Bool
== :: MQTTException -&gt; MQTTException -&gt; Bool
$c== :: MQTTException -&gt; MQTTException -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112964"><span id="local-6989586621679112966"><span id="local-6989586621679112974"><span class="annot"><span class="annottext">Int -&gt; MQTTException -&gt; ShowS
[MQTTException] -&gt; ShowS
MQTTException -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MQTTException] -&gt; ShowS
$cshowList :: [MQTTException] -&gt; ShowS
show :: MQTTException -&gt; String
$cshow :: MQTTException -&gt; String
showsPrec :: Int -&gt; MQTTException -&gt; ShowS
$cshowsPrec :: Int -&gt; MQTTException -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679112953"><span id="local-6989586621679112955"><span id="local-6989586621679112957"><span class="annot"><span class="hs-identifier hs-type">E.Exception</span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier hs-type">MQTTException</span></a></span></span></span></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="annot"><a href="Network.MQTT.Client.html#dispatch"><span class="hs-identifier hs-type">dispatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span id="dispatch"><span class="annot"><span class="annottext">dispatch :: MQTTClient -&gt; TChan Bool -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#dispatch"><span class="hs-identifier hs-var hs-var">dispatch</span></a></span></span><span> </span><span id="local-6989586621679112951"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112938"><span id="local-6989586621679112939"><span id="local-6989586621679112940"><span id="local-6989586621679112941"><span id="local-6989586621679112942"><span id="local-6989586621679112943"><span id="local-6989586621679112944"><span id="local-6989586621679112945"><span id="local-6989586621679112946"><span id="local-6989586621679112947"><span id="local-6989586621679112948"><span id="local-6989586621679112949"><span id="local-6989586621679112950"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112938"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112937"><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679112937"><span class="hs-identifier hs-var">pch</span></a></span></span><span> </span><span id="local-6989586621679112936"><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112936"><span class="hs-identifier hs-var">pkt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112936"><span class="hs-identifier hs-var">pkt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKPkt"><span class="hs-identifier hs-type">ConnACKPkt</span></a></span><span> </span><span id="local-6989586621679112934"><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112934"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConnACKFlags -&gt; IO ()
</span><a href="#local-6989586621679112933"><span class="hs-identifier hs-var">connACKd</span></a></span><span> </span><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112934"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PublishPkt"><span class="hs-identifier hs-type">PublishPkt</span></a></span><span> </span><span id="local-6989586621679112931"><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112931"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112930"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112931"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#SubACKPkt"><span class="hs-identifier hs-type">SubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#SubscribeResponse"><span class="hs-identifier hs-type">SubscribeResponse</span></a></span><span> </span><span id="local-6989586621679112927"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112927"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Either SubErr QoS]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DispatchType -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112926"><span class="hs-identifier hs-var">delegate</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DSubACK"><span class="hs-identifier hs-var">DSubACK</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112927"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#UnsubACKPkt"><span class="hs-identifier hs-type">UnsubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#UnsubscribeResponse"><span class="hs-identifier hs-type">UnsubscribeResponse</span></a></span><span> </span><span id="local-6989586621679112923"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112923"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[UnsubStatus]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DispatchType -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112926"><span class="hs-identifier hs-var">delegate</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DUnsubACK"><span class="hs-identifier hs-var">DUnsubACK</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112923"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubACKPkt"><span class="hs-identifier hs-type">PubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubACK"><span class="hs-identifier hs-type">PubACK</span></a></span><span> </span><span id="local-6989586621679112920"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112920"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DispatchType -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112926"><span class="hs-identifier hs-var">delegate</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubACK"><span class="hs-identifier hs-var">DPubACK</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112920"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubRELPkt"><span class="hs-identifier hs-type">PubRELPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubREL"><span class="hs-identifier hs-type">PubREL</span></a></span><span> </span><span id="local-6989586621679112917"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112917"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; IO ()
</span><a href="#local-6989586621679112916"><span class="hs-identifier hs-var">pubd</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112917"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubRECPkt"><span class="hs-identifier hs-type">PubRECPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubREC"><span class="hs-identifier hs-type">PubREC</span></a></span><span> </span><span id="local-6989586621679112913"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112913"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DispatchType -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112926"><span class="hs-identifier hs-var">delegate</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubREC"><span class="hs-identifier hs-var">DPubREC</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112913"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubCOMPPkt"><span class="hs-identifier hs-type">PubCOMPPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubCOMP"><span class="hs-identifier hs-type">PubCOMP</span></a></span><span> </span><span id="local-6989586621679112910"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112910"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DispatchType -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112926"><span class="hs-identifier hs-var">delegate</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubCOMP"><span class="hs-identifier hs-var">DPubCOMP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112910"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#DisconnectPkt"><span class="hs-identifier hs-type">DisconnectPkt</span></a></span><span> </span><span id="local-6989586621679112908"><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112908"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisconnectRequest -&gt; IO ()
</span><a href="#local-6989586621679112907"><span class="hs-identifier hs-var">disco</span></a></span><span> </span><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112908"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="Network.MQTT.Types.html#PongPkt"><span class="hs-identifier hs-var">PongPkt</span></a></span><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan Bool
</span><a href="#local-6989586621679112937"><span class="hs-identifier hs-var">pch</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-comment">-- Not implemented</span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#AuthPkt"><span class="hs-identifier hs-type">AuthPkt</span></a></span><span> </span><span id="local-6989586621679112904"><span class="annot"><span class="annottext">AuthRequest
</span><a href="#local-6989586621679112904"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected incoming auth: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">AuthRequest
</span><a href="#local-6989586621679112904"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- Things clients shouldn't see</span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="Network.MQTT.Types.html#PingPkt"><span class="hs-identifier hs-var">PingPkt</span></a></span><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected incoming ping packet&quot;</span></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#ConnPkt"><span class="hs-identifier hs-type">ConnPkt</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectRequest
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ProtocolLevel
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected incoming connect&quot;</span></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#SubscribePkt"><span class="hs-identifier hs-type">SubscribePkt</span></a></span><span> </span><span class="annot"><span class="annottext">SubscribeRequest
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected incoming subscribe&quot;</span></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#UnsubscribePkt"><span class="hs-identifier hs-type">UnsubscribePkt</span></a></span><span> </span><span class="annot"><span class="annottext">UnsubscribeRequest
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected incoming unsubscribe&quot;</span></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112933"><span class="annot"><span class="annottext">connACKd :: ConnACKFlags -&gt; IO ()
</span><a href="#local-6989586621679112933"><span class="hs-identifier hs-var hs-var">connACKd</span></a></span></span><span> </span><span id="local-6989586621679112895"><span class="annot"><span class="annottext">connr :: ConnACKFlags
</span><a href="#local-6989586621679112895"><span class="hs-identifier hs-var">connr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-type">ConnACKFlags</span></a></span><span> </span><span class="annot"><span class="annottext">SessionReuse
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112894"><span class="annot"><span class="annottext">ConnACKRC
</span><a href="#local-6989586621679112894"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConnACKRC
</span><a href="#local-6989586621679112894"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-429"></span><span>                                                  </span><span class="annot"><span class="annottext">ConnACKRC
</span><a href="Network.MQTT.Types.html#ConnAccepted"><span class="hs-identifier hs-var">ConnAccepted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-430"></span><span>                                                    </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnACKFlags
</span><a href="#local-6989586621679112941"><span class="hs-identifier hs-var">_connACKFlags</span></a></span><span> </span><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112895"><span class="hs-identifier hs-var">connr</span></a></span><span>
</span><span id="line-431"></span><span>                                                    </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112945"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span>
</span><span id="line-432"></span><span>                                                  </span><span class="annot"><span class="annottext">ConnACKRC
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>                                                    </span><span id="local-6989586621679112892"><span class="annot"><span class="annottext">Maybe (Async ())
</span><a href="#local-6989586621679112892"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112944"><span class="hs-identifier hs-var">_ct</span></a></span><span>
</span><span id="line-434"></span><span>                                                    </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112945"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnACKFlags -&gt; ConnState
</span><a href="Network.MQTT.Client.html#ConnErr"><span class="hs-identifier hs-var">ConnErr</span></a></span><span> </span><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112895"><span class="hs-identifier hs-var">connr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>                                                    </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; e -&gt; Maybe (Async ()) -&gt; IO ()
</span><a href="Network.MQTT.Client.html#maybeCancelWith"><span class="hs-identifier hs-var">maybeCancelWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MQTTException
</span><a href="Network.MQTT.Client.html#MQTTException"><span class="hs-identifier hs-var">MQTTException</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ConnACKFlags
</span><a href="#local-6989586621679112895"><span class="hs-identifier hs-var">connr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Async ())
</span><a href="#local-6989586621679112892"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>        </span><span id="local-6989586621679112930"><span class="annot"><span class="annottext">pub :: PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112930"><span class="hs-identifier hs-var hs-var">pub</span></a></span></span><span> </span><span id="local-6989586621679112877"><span class="annot"><span class="annottext">p :: PublishRequest
</span><a href="#local-6989586621679112877"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_pubQoS :: PublishRequest -&gt; QoS
</span><a href="Network.MQTT.Types.html#_pubQoS"><span class="hs-identifier hs-var">_pubQoS</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS0"><span class="hs-identifier hs-var">QoS0</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PublishRequest -&gt; STM PublishRequest
</span><a href="#local-6989586621679112873"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112877"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *}.
Foldable t =&gt;
t MQTTPkt -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112872"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><a href="#local-6989586621679112930"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span id="local-6989586621679112871"><span class="annot"><span class="annottext">p :: PublishRequest
</span><a href="#local-6989586621679112871"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_pubQoS :: PublishRequest -&gt; QoS
</span><a href="Network.MQTT.Types.html#_pubQoS"><span class="hs-identifier hs-var">_pubQoS</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS1"><span class="hs-identifier hs-var">QoS1</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112869"><span class="annot"><span class="annottext">Word16
_pubPktID :: PublishRequest -&gt; Word16
_pubPktID :: Word16
</span><a href="Network.MQTT.Types.html#_pubPktID"><span class="hs-identifier hs-var hs-var">_pubPktID</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-439"></span><span>          </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *}.
Foldable t =&gt;
t MQTTPkt -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112872"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubACK -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PubACKPkt"><span class="hs-identifier hs-var">PubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; [Property] -&gt; PubACK
</span><a href="Network.MQTT.Types.html#PubACK"><span class="hs-identifier hs-var">PubACK</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112869"><span class="hs-identifier hs-var">_pubPktID</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PublishRequest -&gt; STM PublishRequest
</span><a href="#local-6989586621679112873"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112871"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><a href="#local-6989586621679112930"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span id="local-6989586621679112867"><span class="annot"><span class="annottext">p :: PublishRequest
</span><a href="#local-6989586621679112867"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_pubQoS :: PublishRequest -&gt; QoS
</span><a href="Network.MQTT.Types.html#_pubQoS"><span class="hs-identifier hs-var">_pubQoS</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS2"><span class="hs-identifier hs-var">QoS2</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>          </span><span id="local-6989586621679112865"><span class="annot"><span class="annottext">p' :: PublishRequest
</span><a href="#local-6989586621679112865"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112858"><span id="local-6989586621679112859"><span id="local-6989586621679112860"><span id="local-6989586621679112861"><span id="local-6989586621679112862"><span id="local-6989586621679112863"><span id="local-6989586621679112864"><span class="annot"><span class="annottext">Bool
[Property]
Word16
ByteString
QoS
_pubProps :: PublishRequest -&gt; [Property]
_pubBody :: PublishRequest -&gt; ByteString
_pubTopic :: PublishRequest -&gt; ByteString
_pubRetain :: PublishRequest -&gt; Bool
_pubDup :: PublishRequest -&gt; Bool
_pubProps :: [Property]
_pubBody :: ByteString
_pubPktID :: Word16
_pubTopic :: ByteString
_pubRetain :: Bool
_pubQoS :: QoS
_pubDup :: Bool
_pubPktID :: PublishRequest -&gt; Word16
_pubQoS :: PublishRequest -&gt; QoS
</span><a href="Network.MQTT.Types.html#_pubProps"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PublishRequest -&gt; STM PublishRequest
</span><a href="#local-6989586621679112873"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112867"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-442"></span><span>          </span><span class="annot"><span class="annottext">forall k v. Ord k =&gt; k -&gt; v -&gt; Map k v -&gt; STM ()
</span><a href="Data.Map.Strict.Decaying.html#insert"><span class="hs-identifier hs-var">Decaying.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112860"><span class="hs-identifier hs-var">_pubPktID</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112865"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word16 PublishRequest
</span><a href="#local-6989586621679112946"><span class="hs-identifier hs-var">_inflight</span></a></span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; STM ()
</span><a href="Network.MQTT.Client.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubREC -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PubRECPkt"><span class="hs-identifier hs-var">PubRECPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; [Property] -&gt; PubREC
</span><a href="Network.MQTT.Types.html#PubREC"><span class="hs-identifier hs-var">PubREC</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112860"><span class="hs-identifier hs-var">_pubPktID</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>        </span><span id="local-6989586621679112916"><span class="annot"><span class="annottext">pubd :: Word16 -&gt; IO ()
</span><a href="#local-6989586621679112916"><span class="hs-identifier hs-var hs-var">pubd</span></a></span></span><span> </span><span id="local-6989586621679112843"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112843"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>          </span><span id="local-6989586621679112842"><span class="annot"><span class="annottext">Maybe PublishRequest
</span><a href="#local-6989586621679112842"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a.
Ord k =&gt;
(k -&gt; a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; STM (Maybe a)
</span><a href="Data.Map.Strict.Decaying.html#updateLookupWithKey"><span class="hs-identifier hs-var">Decaying.updateLookupWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112843"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word16 PublishRequest
</span><a href="#local-6989586621679112946"><span class="hs-identifier hs-var">_inflight</span></a></span><span>
</span><span id="line-447"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PublishRequest
</span><a href="#local-6989586621679112842"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-448"></span><span>            </span><span class="annot"><span class="annottext">Maybe PublishRequest
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var">sendPacketIO</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubCOMP -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PubCOMPPkt"><span class="hs-identifier hs-var">PubCOMPPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; [Property] -&gt; PubCOMP
</span><a href="Network.MQTT.Types.html#PubCOMP"><span class="hs-identifier hs-var">PubCOMP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112843"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x92</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679112840"><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112840"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *}.
Foldable t =&gt;
t MQTTPkt -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112872"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubCOMP -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PubCOMPPkt"><span class="hs-identifier hs-var">PubCOMPPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; [Property] -&gt; PubCOMP
</span><a href="Network.MQTT.Types.html#PubCOMP"><span class="hs-identifier hs-var">PubCOMP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112843"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112840"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>        </span><span id="local-6989586621679112872"><span class="annot"><span class="annottext">notify :: t MQTTPkt -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112872"><span class="hs-identifier hs-var hs-var">notify</span></a></span></span><span> </span><span id="local-6989586621679112829"><span class="annot"><span class="annottext">t MQTTPkt
</span><a href="#local-6989586621679112829"><span class="hs-identifier hs-var">rpkt</span></a></span></span><span> </span><span id="local-6989586621679112828"><span class="annot"><span class="annottext">p :: PublishRequest
</span><a href="#local-6989586621679112828"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112821"><span id="local-6989586621679112822"><span id="local-6989586621679112823"><span id="local-6989586621679112824"><span id="local-6989586621679112825"><span id="local-6989586621679112826"><span id="local-6989586621679112827"><span class="annot"><span class="annottext">Bool
[Property]
Word16
ByteString
QoS
_pubProps :: [Property]
_pubBody :: ByteString
_pubPktID :: Word16
_pubTopic :: ByteString
_pubRetain :: Bool
_pubQoS :: QoS
_pubDup :: Bool
_pubProps :: PublishRequest -&gt; [Property]
_pubBody :: PublishRequest -&gt; ByteString
_pubTopic :: PublishRequest -&gt; ByteString
_pubRetain :: PublishRequest -&gt; Bool
_pubDup :: PublishRequest -&gt; Bool
_pubPktID :: PublishRequest -&gt; Word16
_pubQoS :: PublishRequest -&gt; QoS
</span><a href="#local-6989586621679112821"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-452"></span><span>          </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. Ord k =&gt; k -&gt; Map k v -&gt; STM ()
</span><a href="Data.Map.Strict.Decaying.html#delete"><span class="hs-identifier hs-var">Decaying.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112823"><span class="hs-identifier hs-var">_pubPktID</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word16 PublishRequest
</span><a href="#local-6989586621679112946"><span class="hs-identifier hs-var">_inflight</span></a></span><span>
</span><span id="line-453"></span><span>          </span><span id="local-6989586621679112819"><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112819"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112948"><span class="hs-identifier hs-var">_cb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679112818"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112818"><span class="hs-identifier hs-var">cd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. Ord k =&gt; v -&gt; k -&gt; Map k v -&gt; STM v
</span><a href="Data.Map.Strict.Decaying.html#findWithDefault"><span class="hs-identifier hs-var">Decaying.findWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112948"><span class="hs-identifier hs-var">_cb</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112818"><span class="hs-identifier hs-var">cd</span></a></span><span> </span><span class="annot"><span class="annottext">Map ByteString MessageCallback
</span><a href="#local-6989586621679112940"><span class="hs-identifier hs-var">_corr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679112816"><span class="hs-identifier hs-var">cdata</span></a></span><span>
</span><span id="line-454"></span><span>          </span><span class="annot"><span class="annottext">forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">E.evaluate</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112819"><span class="hs-identifier hs-var">cb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-455"></span><span>                                   </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="Network.MQTT.Client.html#NoCallback"><span class="hs-identifier hs-var">NoCallback</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>                                   </span><span class="annot"><a href="Network.MQTT.Client.html#SimpleCallback"><span class="hs-identifier hs-type">SimpleCallback</span></a></span><span> </span><span id="local-6989586621679112814"><span class="annot"><span class="annottext">MQTTClient -&gt; Topic -&gt; ByteString -&gt; [Property] -&gt; IO ()
</span><a href="#local-6989586621679112814"><span class="hs-identifier hs-var">f</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a}. IO a -&gt; IO ()
</span><a href="#local-6989586621679112813"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; Topic -&gt; ByteString -&gt; [Property] -&gt; IO ()
</span><a href="#local-6989586621679112814"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Topic
</span><a href="Network.MQTT.Client.html#blToTopic"><span class="hs-identifier hs-var">blToTopic</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112824"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112822"><span class="hs-identifier hs-var">_pubBody</span></a></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112821"><span class="hs-identifier hs-var">_pubProps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>                                   </span><span class="annot"><a href="Network.MQTT.Client.html#OrderedCallback"><span class="hs-identifier hs-type">OrderedCallback</span></a></span><span> </span><span id="local-6989586621679112811"><span class="annot"><span class="annottext">MQTTClient -&gt; Topic -&gt; ByteString -&gt; [Property] -&gt; IO ()
</span><a href="#local-6989586621679112811"><span class="hs-identifier hs-var">f</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a}. IO a -&gt; IO ()
</span><a href="#local-6989586621679112810"><span class="hs-identifier hs-var">callOrd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; Topic -&gt; ByteString -&gt; [Property] -&gt; IO ()
</span><a href="#local-6989586621679112811"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Topic
</span><a href="Network.MQTT.Client.html#blToTopic"><span class="hs-identifier hs-var">blToTopic</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112824"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112822"><span class="hs-identifier hs-var">_pubBody</span></a></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112821"><span class="hs-identifier hs-var">_pubProps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>                                   </span><span class="annot"><a href="Network.MQTT.Client.html#LowLevelCallback"><span class="hs-identifier hs-type">LowLevelCallback</span></a></span><span> </span><span id="local-6989586621679112809"><span class="annot"><span class="annottext">MQTTClient -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112809"><span class="hs-identifier hs-var">f</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a}. IO a -&gt; IO ()
</span><a href="#local-6989586621679112813"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112809"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112828"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>                                   </span><span class="annot"><a href="Network.MQTT.Client.html#OrderedLowLevelCallback"><span class="hs-identifier hs-type">OrderedLowLevelCallback</span></a></span><span> </span><span id="local-6989586621679112808"><span class="annot"><span class="annottext">MQTTClient -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112808"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a}. IO a -&gt; IO ()
</span><a href="#local-6989586621679112810"><span class="hs-identifier hs-var">callOrd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; PublishRequest -&gt; IO ()
</span><a href="#local-6989586621679112808"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112828"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-462"></span><span>              </span><span id="local-6989586621679112813"><span class="annot"><span class="annottext">call :: IO a -&gt; IO ()
</span><a href="#local-6989586621679112813"><span class="hs-identifier hs-var hs-var">call</span></a></span></span><span> </span><span id="local-6989586621679112805"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679112805"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO ()
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;notifier&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679112805"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679112804"><span class="hs-identifier hs-var">respond</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>              </span><span id="local-6989586621679112810"><span class="annot"><span class="annottext">callOrd :: IO a -&gt; IO ()
</span><a href="#local-6989586621679112810"><span class="hs-identifier hs-var hs-var">callOrd</span></a></span></span><span> </span><span id="local-6989586621679112802"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679112802"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (IO ())
</span><a href="#local-6989586621679112939"><span class="hs-identifier hs-var">_cbM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679112802"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679112804"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-464"></span><span>              </span><span id="local-6989586621679112804"><span class="annot"><span class="annottext">respond :: IO ()
</span><a href="#local-6989586621679112804"><span class="hs-identifier hs-var hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var">sendPacketIO</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t MQTTPkt
</span><a href="#local-6989586621679112829"><span class="hs-identifier hs-var">rpkt</span></a></span><span>
</span><span id="line-465"></span><span>              </span><span id="local-6989586621679112816"><span class="annot"><span class="annottext">cdata :: Maybe ByteString
</span><a href="#local-6989586621679112816"><span class="hs-identifier hs-var hs-var">cdata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Property -&gt; Maybe ByteString -&gt; Maybe ByteString
</span><a href="#local-6989586621679112797"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112821"><span class="hs-identifier hs-var">_pubProps</span></a></span><span>
</span><span id="line-466"></span><span>                </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112797"><span class="annot"><span class="annottext">f :: Property -&gt; Maybe ByteString -&gt; Maybe ByteString
</span><a href="#local-6989586621679112797"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PropCorrelationData"><span class="hs-identifier hs-type">PropCorrelationData</span></a></span><span> </span><span id="local-6989586621679112795"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112795"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112795"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-467"></span><span>                      </span><span class="annot"><a href="#local-6989586621679112797"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Property
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112794"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679112794"><span class="hs-identifier hs-var">o</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679112794"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>        </span><span id="local-6989586621679112873"><span class="annot"><span class="annottext">resolve :: PublishRequest -&gt; STM PublishRequest
</span><a href="#local-6989586621679112873"><span class="hs-identifier hs-var hs-var">resolve</span></a></span></span><span> </span><span id="local-6989586621679112790"><span class="annot"><span class="annottext">p :: PublishRequest
</span><a href="#local-6989586621679112790"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112783"><span id="local-6989586621679112784"><span id="local-6989586621679112785"><span id="local-6989586621679112786"><span id="local-6989586621679112787"><span id="local-6989586621679112788"><span id="local-6989586621679112789"><span class="annot"><span class="annottext">Bool
[Property]
Word16
ByteString
QoS
_pubProps :: [Property]
_pubBody :: ByteString
_pubPktID :: Word16
_pubTopic :: ByteString
_pubRetain :: Bool
_pubQoS :: QoS
_pubDup :: Bool
_pubProps :: PublishRequest -&gt; [Property]
_pubBody :: PublishRequest -&gt; ByteString
_pubTopic :: PublishRequest -&gt; ByteString
_pubRetain :: PublishRequest -&gt; Bool
_pubDup :: PublishRequest -&gt; Bool
_pubPktID :: PublishRequest -&gt; Word16
_pubQoS :: PublishRequest -&gt; QoS
</span><a href="#local-6989586621679112783"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>          </span><span id="local-6989586621679112782"><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112782"><span class="hs-identifier hs-var">topic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Word16 -&gt; STM Topic
</span><a href="#local-6989586621679112781"><span class="hs-identifier hs-var">resolveTopic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Property -&gt; Maybe Word16 -&gt; Maybe Word16
</span><a href="#local-6989586621679112780"><span class="hs-identifier hs-var">aliasID</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112783"><span class="hs-identifier hs-var">_pubProps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PublishRequest
</span><a href="#local-6989586621679112790"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_pubTopic :: ByteString
</span><a href="Network.MQTT.Types.html#_pubTopic"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Topic -&gt; ByteString
</span><a href="Network.MQTT.Client.html#topicToBL"><span class="hs-identifier hs-var">topicToBL</span></a></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112782"><span class="hs-identifier hs-var">topic</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-474"></span><span>            </span><span id="local-6989586621679112780"><span class="annot"><span class="annottext">aliasID :: Property -&gt; Maybe Word16 -&gt; Maybe Word16
</span><a href="#local-6989586621679112780"><span class="hs-identifier hs-var hs-var">aliasID</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PropTopicAlias"><span class="hs-identifier hs-type">PropTopicAlias</span></a></span><span> </span><span id="local-6989586621679112777"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112777"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112777"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><a href="#local-6989586621679112780"><span class="hs-identifier hs-var">aliasID</span></a></span><span> </span><span class="annot"><span class="annottext">Property
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112776"><span class="annot"><span class="annottext">Maybe Word16
</span><a href="#local-6989586621679112776"><span class="hs-identifier hs-var">o</span></a></span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Word16
</span><a href="#local-6989586621679112776"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>            </span><span id="local-6989586621679112781"><span class="annot"><span class="annottext">resolveTopic :: Maybe Word16 -&gt; STM Topic
</span><a href="#local-6989586621679112781"><span class="hs-identifier hs-var hs-var">resolveTopic</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Word16
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Topic
</span><a href="Network.MQTT.Client.html#blToTopic"><span class="hs-identifier hs-var">blToTopic</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112786"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>            </span><span class="annot"><a href="#local-6989586621679112781"><span class="hs-identifier hs-var">resolveTopic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679112759"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112759"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>              </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112786"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map Word16 Topic)
</span><a href="#local-6989586621679112942"><span class="hs-identifier hs-var">_inA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112759"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Topic
</span><a href="Network.MQTT.Client.html#blToTopic"><span class="hs-identifier hs-var">blToTopic</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112786"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>              </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;failed to lookup topic alias &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112759"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112759"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map Word16 Topic)
</span><a href="#local-6989586621679112942"><span class="hs-identifier hs-var">_inA</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>        </span><span id="local-6989586621679112926"><span class="annot"><span class="annottext">delegate :: DispatchType -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112926"><span class="hs-identifier hs-var hs-var">delegate</span></a></span></span><span> </span><span id="local-6989586621679112751"><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112751"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span id="local-6989586621679112750"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112750"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-483"></span><span>          </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DispatchType -&gt; STM ()
</span><a href="#local-6989586621679112749"><span class="hs-identifier hs-var">nak</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112751"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-operator hs-var">`writeTChan`</span></span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112936"><span class="hs-identifier hs-var">pkt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112751"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112750"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
</span><a href="#local-6989586621679112947"><span class="hs-identifier hs-var">_acks</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-486"></span><span>              </span><span id="local-6989586621679112749"><span class="annot"><span class="annottext">nak :: DispatchType -&gt; STM ()
</span><a href="#local-6989586621679112749"><span class="hs-identifier hs-var hs-var">nak</span></a></span></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubREC"><span class="hs-identifier hs-var">DPubREC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; STM ()
</span><a href="Network.MQTT.Client.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112951"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubREL -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PubRELPkt"><span class="hs-identifier hs-var">PubRELPkt</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; [Property] -&gt; PubREL
</span><a href="Network.MQTT.Types.html#PubREL"><span class="hs-identifier hs-var">PubREL</span></a></span><span>  </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112750"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x92</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>              </span><span class="annot"><a href="#local-6989586621679112749"><span class="hs-identifier hs-var">nak</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>        </span><span id="local-6989586621679112907"><span class="annot"><span class="annottext">disco :: DisconnectRequest -&gt; IO ()
</span><a href="#local-6989586621679112907"><span class="hs-identifier hs-var hs-var">disco</span></a></span></span><span> </span><span id="local-6989586621679112742"><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112742"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>          </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112945"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DisconnectRequest -&gt; ConnState
</span><a href="Network.MQTT.Client.html#DiscoErr"><span class="hs-identifier hs-var">DiscoErr</span></a></span><span> </span><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112742"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>          </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; e -&gt; Maybe (Async ()) -&gt; IO ()
</span><a href="Network.MQTT.Client.html#maybeCancelWith"><span class="hs-identifier hs-var">maybeCancelWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DisconnectRequest -&gt; MQTTException
</span><a href="Network.MQTT.Client.html#Discod"><span class="hs-identifier hs-var">Discod</span></a></span><span> </span><span class="annot"><span class="annottext">DisconnectRequest
</span><a href="#local-6989586621679112742"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112944"><span class="hs-identifier hs-var">_ct</span></a></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-comment">-- Run OrderedCallbacks in a background thread. Does nothing for other callback types.</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- We keep the async handle in a TVar and make sure only one of these threads is running.</span><span>
</span><span id="line-496"></span><span class="annot"><a href="Network.MQTT.Client.html#runCallbackThread"><span class="hs-identifier hs-type">runCallbackThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span id="runCallbackThread"><span class="annot"><span class="annottext">runCallbackThread :: MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#runCallbackThread"><span class="hs-identifier hs-var hs-var">runCallbackThread</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112740"><span class="annot"><span class="annottext">MessageCallback
_cb :: MessageCallback
_cb :: MQTTClient -&gt; MessageCallback
</span><a href="#local-6989586621679112740"><span class="hs-identifier hs-var hs-var">_cb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112739"><span class="annot"><span class="annottext">MVar (IO ())
_cbM :: MVar (IO ())
_cbM :: MQTTClient -&gt; MVar (IO ())
</span><a href="#local-6989586621679112739"><span class="hs-identifier hs-var hs-var">_cbM</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112738"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
_cbHandle :: TVar (Maybe (Async ()))
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112738"><span class="hs-identifier hs-var hs-var">_cbHandle</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MessageCallback -&gt; Bool
</span><a href="#local-6989586621679112737"><span class="hs-identifier hs-var">isOrdered</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112740"><span class="hs-identifier hs-var">_cb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-comment">-- We always spawn a thread, but may kill it if we already have</span><span>
</span><span id="line-500"></span><span>      </span><span class="hs-comment">-- one.  The new thread won't start until we atomically confirm</span><span>
</span><span id="line-501"></span><span>      </span><span class="hs-comment">-- it's the only one.</span><span>
</span><span id="line-502"></span><span>      </span><span id="local-6989586621679112736"><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679112736"><span class="hs-identifier hs-var">latch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-503"></span><span>      </span><span id="local-6989586621679112735"><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679112735"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; IO a -&gt; IO (Async a)
</span><a href="Network.MQTT.Client.html#namedAsync"><span class="hs-identifier hs-var">namedAsync</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ordered callbacks&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TVar Bool -&gt; IO ()
</span><a href="#local-6989586621679112734"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679112736"><span class="hs-identifier hs-var">latch</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {b}. IO b
</span><a href="#local-6989586621679112733"><span class="hs-identifier hs-var">runOrderedCallbacks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-505"></span><span>        </span><span id="local-6989586621679112732"><span class="annot"><span class="annottext">Maybe (Async ())
</span><a href="#local-6989586621679112732"><span class="hs-identifier hs-var">cbThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112738"><span class="hs-identifier hs-var">_cbHandle</span></a></span><span>
</span><span id="line-506"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Async ())
</span><a href="#local-6989586621679112732"><span class="hs-identifier hs-var">cbThread</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-507"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Async ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>            </span><span class="hs-comment">-- This is the first thread.  Flip the latch and put it in place.</span><span>
</span><span id="line-509"></span><span>            </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679112736"><span class="hs-identifier hs-var">latch</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-510"></span><span>            </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112738"><span class="hs-identifier hs-var">_cbHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679112735"><span class="hs-identifier hs-var">handle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO ()
</span><span class="hs-identifier hs-var">cancel</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621679112735"><span class="hs-identifier hs-var">handle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- otherwise, cancel the temporary thread.</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112737"><span class="annot"><span class="annottext">isOrdered :: MessageCallback -&gt; Bool
</span><a href="#local-6989586621679112737"><span class="hs-identifier hs-var hs-var">isOrdered</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#OrderedCallback"><span class="hs-identifier hs-type">OrderedCallback</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; Topic -&gt; ByteString -&gt; [Property] -&gt; IO ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-515"></span><span>          </span><span class="annot"><a href="#local-6989586621679112737"><span class="hs-identifier hs-var">isOrdered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#OrderedLowLevelCallback"><span class="hs-identifier hs-type">OrderedLowLevelCallback</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; PublishRequest -&gt; IO ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-516"></span><span>          </span><span class="annot"><a href="#local-6989586621679112737"><span class="hs-identifier hs-var">isOrdered</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><span class="hs-identifier">_</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-517"></span><span>          </span><span id="local-6989586621679112734"><span class="annot"><span class="annottext">waitFor :: TVar Bool -&gt; IO ()
</span><a href="#local-6989586621679112734"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span></span><span> </span><span id="local-6989586621679112730"><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679112730"><span class="hs-identifier hs-var">latch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; STM ()
</span><span class="hs-identifier hs-var">check</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679112730"><span class="hs-identifier hs-var">latch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>          </span><span class="hs-comment">-- Keep running callbacks from the MVar</span><span>
</span><span id="line-519"></span><span>          </span><span id="local-6989586621679112733"><span class="annot"><span class="annottext">runOrderedCallbacks :: IO b
</span><a href="#local-6989586621679112733"><span class="hs-identifier hs-var hs-var">runOrderedCallbacks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (IO ())
</span><a href="#local-6989586621679112739"><span class="hs-identifier hs-var">_cbM</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- Stop the background thread for OrderedCallbacks. Does nothing for other callback types.</span><span>
</span><span id="line-522"></span><span class="annot"><a href="Network.MQTT.Client.html#stopCallbackThread"><span class="hs-identifier hs-type">stopCallbackThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span id="stopCallbackThread"><span class="annot"><span class="annottext">stopCallbackThread :: MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#stopCallbackThread"><span class="hs-identifier hs-var hs-var">stopCallbackThread</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112727"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
_cbHandle :: TVar (Maybe (Async ()))
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112727"><span class="hs-identifier hs-var hs-var">_cbHandle</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO ()
</span><span class="hs-identifier hs-var">cancel</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112727"><span class="hs-identifier hs-var">_cbHandle</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span id="local-6989586621679113992"><span class="annot"><a href="Network.MQTT.Client.html#maybeCancelWith"><span class="hs-identifier hs-type">maybeCancelWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621679113992"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679113992"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-526"></span><span id="maybeCancelWith"><span class="annot"><span class="annottext">maybeCancelWith :: forall e. Exception e =&gt; e -&gt; Maybe (Async ()) -&gt; IO ()
</span><a href="Network.MQTT.Client.html#maybeCancelWith"><span class="hs-identifier hs-var hs-var">maybeCancelWith</span></a></span></span><span> </span><span id="local-6989586621679112721"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679112721"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; Async a -&gt; e -&gt; IO ()
</span><span class="hs-operator hs-var">`cancelWith`</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679112721"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span id="local-6989586621679114017"><span class="annot"><a href="Network.MQTT.Client.html#killConn"><span class="hs-identifier hs-type">killConn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621679114017"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679114017"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-529"></span><span id="killConn"><span class="annot"><span class="annottext">killConn :: forall e. Exception e =&gt; MQTTClient -&gt; e -&gt; IO ()
</span><a href="Network.MQTT.Client.html#killConn"><span class="hs-identifier hs-var hs-var">killConn</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112705"><span id="local-6989586621679112706"><span id="local-6989586621679112707"><span id="local-6989586621679112708"><span id="local-6989586621679112709"><span id="local-6989586621679112710"><span id="local-6989586621679112711"><span id="local-6989586621679112712"><span id="local-6989586621679112713"><span id="local-6989586621679112714"><span id="local-6989586621679112715"><span id="local-6989586621679112716"><span id="local-6989586621679112717"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112705"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112704"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679112704"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112711"><span class="hs-identifier hs-var">_ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; e -&gt; Maybe (Async ()) -&gt; IO ()
</span><a href="Network.MQTT.Client.html#maybeCancelWith"><span class="hs-identifier hs-var">maybeCancelWith</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679112704"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="annot"><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-type">checkConnected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span id="checkConnected"><span class="annot"><span class="annottext">checkConnected :: MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var hs-var">checkConnected</span></a></span></span><span> </span><span id="local-6989586621679112703"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112703"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">E.throw</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; ConnState -&gt; STM (Maybe SomeException)
</span><a href="Network.MQTT.Client.html#stateX"><span class="hs-identifier hs-var">stateX</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112703"><span class="hs-identifier hs-var">mc</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-comment">-- | True if we're currently in a normally connected state (in the IO monad).</span><span>
</span><span id="line-535"></span><span class="annot"><a href="Network.MQTT.Client.html#isConnected"><span class="hs-identifier hs-type">isConnected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-536"></span><span id="isConnected"><span class="annot"><span class="annottext">isConnected :: MQTTClient -&gt; IO Bool
</span><a href="Network.MQTT.Client.html#isConnected"><span class="hs-identifier hs-var hs-var">isConnected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM Bool
</span><a href="Network.MQTT.Client.html#isConnectedSTM"><span class="hs-identifier hs-var">isConnectedSTM</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-comment">-- | True if we're currently in a normally connected state (in the STM monad).</span><span>
</span><span id="line-539"></span><span class="annot"><a href="Network.MQTT.Client.html#isConnectedSTM"><span class="hs-identifier hs-type">isConnectedSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-540"></span><span id="isConnectedSTM"><span class="annot"><span class="annottext">isConnectedSTM :: MQTTClient -&gt; STM Bool
</span><a href="Network.MQTT.Client.html#isConnectedSTM"><span class="hs-identifier hs-var hs-var">isConnectedSTM</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112690"><span id="local-6989586621679112691"><span id="local-6989586621679112692"><span id="local-6989586621679112693"><span id="local-6989586621679112694"><span id="local-6989586621679112695"><span id="local-6989586621679112696"><span id="local-6989586621679112697"><span id="local-6989586621679112698"><span id="local-6989586621679112699"><span id="local-6989586621679112700"><span id="local-6989586621679112701"><span id="local-6989586621679112702"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112690"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112697"><span class="hs-identifier hs-var">_st</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="Network.MQTT.Client.html#sendPacket"><span class="hs-identifier hs-type">sendPacket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span id="sendPacket"><span class="annot"><span class="annottext">sendPacket :: MQTTClient -&gt; MQTTPkt -&gt; STM ()
</span><a href="Network.MQTT.Client.html#sendPacket"><span class="hs-identifier hs-var hs-var">sendPacket</span></a></span></span><span> </span><span id="local-6989586621679112689"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112689"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112676"><span id="local-6989586621679112677"><span id="local-6989586621679112678"><span id="local-6989586621679112679"><span id="local-6989586621679112680"><span id="local-6989586621679112681"><span id="local-6989586621679112682"><span id="local-6989586621679112683"><span id="local-6989586621679112684"><span id="local-6989586621679112685"><span id="local-6989586621679112686"><span id="local-6989586621679112687"><span id="local-6989586621679112688"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112676"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112675"><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112675"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112689"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112688"><span class="hs-identifier hs-var">_ch</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112675"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="annot"><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-type">sendPacketIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span id="sendPacketIO"><span class="annot"><span class="annottext">sendPacketIO :: MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var hs-var">sendPacketIO</span></a></span></span><span> </span><span id="local-6989586621679112674"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112674"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; STM ()
</span><a href="Network.MQTT.Client.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112674"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="annot"><a href="Network.MQTT.Client.html#textToBL"><span class="hs-identifier hs-type">textToBL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span>
</span><span id="line-549"></span><span id="textToBL"><span class="annot"><span class="annottext">textToBL :: Text -&gt; ByteString
</span><a href="Network.MQTT.Client.html#textToBL"><span class="hs-identifier hs-var hs-var">textToBL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.fromStrict</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">TE.encodeUtf8</span></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="annot"><a href="Network.MQTT.Client.html#blToText"><span class="hs-identifier hs-type">blToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-552"></span><span id="blToText"><span class="annot"><span class="annottext">blToText :: ByteString -&gt; Text
</span><a href="Network.MQTT.Client.html#blToText"><span class="hs-identifier hs-var hs-var">blToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">TE.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="annot"><a href="Network.MQTT.Client.html#topicToBL"><span class="hs-identifier hs-type">topicToBL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span>
</span><span id="line-555"></span><span id="topicToBL"><span class="annot"><span class="annottext">topicToBL :: Topic -&gt; ByteString
</span><a href="Network.MQTT.Client.html#topicToBL"><span class="hs-identifier hs-var hs-var">topicToBL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="Network.MQTT.Client.html#textToBL"><span class="hs-identifier hs-var">textToBL</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Topic -&gt; Text
</span><a href="Network.MQTT.Topic.html#unTopic"><span class="hs-identifier hs-var">unTopic</span></a></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="annot"><a href="Network.MQTT.Client.html#filterToBL"><span class="hs-identifier hs-type">filterToBL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Filter"><span class="hs-identifier hs-type">Filter</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span>
</span><span id="line-558"></span><span id="filterToBL"><span class="annot"><span class="annottext">filterToBL :: Filter -&gt; ByteString
</span><a href="Network.MQTT.Client.html#filterToBL"><span class="hs-identifier hs-var hs-var">filterToBL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="Network.MQTT.Client.html#textToBL"><span class="hs-identifier hs-var">textToBL</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; Text
</span><a href="Network.MQTT.Topic.html#unFilter"><span class="hs-identifier hs-var">unFilter</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="annot"><a href="Network.MQTT.Client.html#blToTopic"><span class="hs-identifier hs-type">blToTopic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span>
</span><span id="line-561"></span><span id="blToTopic"><span class="annot"><span class="annottext">blToTopic :: ByteString -&gt; Topic
</span><a href="Network.MQTT.Client.html#blToTopic"><span class="hs-identifier hs-var hs-var">blToTopic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Topic
</span><a href="Network.MQTT.Topic.html#mkTopic"><span class="hs-identifier hs-var">mkTopic</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Network.MQTT.Client.html#blToText"><span class="hs-identifier hs-var">blToText</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="annot"><a href="Network.MQTT.Client.html#reservePktID"><span class="hs-identifier hs-type">reservePktID</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Client.html#DispatchType"><span class="hs-identifier hs-type">DispatchType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span id="reservePktID"><span class="annot"><span class="annottext">reservePktID :: MQTTClient -&gt; [DispatchType] -&gt; STM (TChan MQTTPkt, Word16)
</span><a href="Network.MQTT.Client.html#reservePktID"><span class="hs-identifier hs-var hs-var">reservePktID</span></a></span></span><span> </span><span id="local-6989586621679112666"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112666"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112653"><span id="local-6989586621679112654"><span id="local-6989586621679112655"><span id="local-6989586621679112656"><span id="local-6989586621679112657"><span id="local-6989586621679112658"><span id="local-6989586621679112659"><span id="local-6989586621679112660"><span id="local-6989586621679112661"><span id="local-6989586621679112662"><span id="local-6989586621679112663"><span id="local-6989586621679112664"><span id="local-6989586621679112665"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112653"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112652"><span class="annot"><span class="annottext">[DispatchType]
</span><a href="#local-6989586621679112652"><span class="hs-identifier hs-var">dts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-565"></span><span>  </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112666"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-566"></span><span>  </span><span id="local-6989586621679112651"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112651"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM (TChan a)
</span><span class="hs-identifier hs-var">newTChan</span></span><span>
</span><span id="line-567"></span><span>  </span><span id="local-6989586621679112650"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112650"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Word16
</span><a href="#local-6989586621679112664"><span class="hs-identifier hs-var">_pktID</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar Word16
</span><a href="#local-6989586621679112664"><span class="hs-identifier hs-var">_pktID</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112650"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
</span><a href="#local-6989586621679112662"><span class="hs-identifier hs-var">_acks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112644"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112650"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112651"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679112644"><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112644"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DispatchType]
</span><a href="#local-6989586621679112652"><span class="hs-identifier hs-var">dts</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112651"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112650"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="annot"><a href="Network.MQTT.Client.html#releasePktID"><span class="hs-identifier hs-type">releasePktID</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#DispatchType"><span class="hs-identifier hs-type">DispatchType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span id="releasePktID"><span class="annot"><span class="annottext">releasePktID :: MQTTClient -&gt; (DispatchType, Word16) -&gt; STM ()
</span><a href="Network.MQTT.Client.html#releasePktID"><span class="hs-identifier hs-var hs-var">releasePktID</span></a></span></span><span> </span><span id="local-6989586621679112642"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112642"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112629"><span id="local-6989586621679112630"><span id="local-6989586621679112631"><span id="local-6989586621679112632"><span id="local-6989586621679112633"><span id="local-6989586621679112634"><span id="local-6989586621679112635"><span id="local-6989586621679112636"><span id="local-6989586621679112637"><span id="local-6989586621679112638"><span id="local-6989586621679112639"><span id="local-6989586621679112640"><span id="local-6989586621679112641"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112629"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112628"><span class="annot"><span class="annottext">(DispatchType, Word16)
</span><a href="#local-6989586621679112628"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112642"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
</span><a href="#local-6989586621679112638"><span class="hs-identifier hs-var">_acks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">(DispatchType, Word16)
</span><a href="#local-6989586621679112628"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="annot"><a href="Network.MQTT.Client.html#releasePktIDs"><span class="hs-identifier hs-type">releasePktIDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Client.html#DispatchType"><span class="hs-identifier hs-type">DispatchType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span id="releasePktIDs"><span class="annot"><span class="annottext">releasePktIDs :: MQTTClient -&gt; [(DispatchType, Word16)] -&gt; STM ()
</span><a href="Network.MQTT.Client.html#releasePktIDs"><span class="hs-identifier hs-var hs-var">releasePktIDs</span></a></span></span><span> </span><span id="local-6989586621679112625"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112625"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112612"><span id="local-6989586621679112613"><span id="local-6989586621679112614"><span id="local-6989586621679112615"><span id="local-6989586621679112616"><span id="local-6989586621679112617"><span id="local-6989586621679112618"><span id="local-6989586621679112619"><span id="local-6989586621679112620"><span id="local-6989586621679112621"><span id="local-6989586621679112622"><span id="local-6989586621679112623"><span id="local-6989586621679112624"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112612"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112611"><span class="annot"><span class="annottext">[(DispatchType, Word16)]
</span><a href="#local-6989586621679112611"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112625"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
</span><a href="#local-6989586621679112621"><span class="hs-identifier hs-var">_acks</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}.
Map (DispatchType, Word16) a -&gt; Map (DispatchType, Word16) a
</span><a href="#local-6989586621679112610"><span class="hs-identifier hs-var">deleteMany</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112610"><span class="annot"><span class="annottext">deleteMany :: Map (DispatchType, Word16) a -&gt; Map (DispatchType, Word16) a
</span><a href="#local-6989586621679112610"><span class="hs-identifier hs-var hs-var">deleteMany</span></a></span></span><span> </span><span id="local-6989586621679112605"><span class="annot"><span class="annottext">Map (DispatchType, Word16) a
</span><a href="#local-6989586621679112605"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span> </span><span class="annot"><span class="annottext">Map (DispatchType, Word16) a
</span><a href="#local-6989586621679112605"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(DispatchType, Word16)]
</span><a href="#local-6989586621679112611"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><a href="Network.MQTT.Client.html#sendAndWait"><span class="hs-identifier hs-type">sendAndWait</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#DispatchType"><span class="hs-identifier hs-type">DispatchType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#MQTTPkt"><span class="hs-identifier hs-type">MQTTPkt</span></a></span><span>
</span><span id="line-580"></span><span id="sendAndWait"><span class="annot"><span class="annottext">sendAndWait :: MQTTClient -&gt; DispatchType -&gt; (Word16 -&gt; MQTTPkt) -&gt; IO MQTTPkt
</span><a href="Network.MQTT.Client.html#sendAndWait"><span class="hs-identifier hs-var hs-var">sendAndWait</span></a></span></span><span> </span><span id="local-6989586621679112601"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112601"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112588"><span id="local-6989586621679112589"><span id="local-6989586621679112590"><span id="local-6989586621679112591"><span id="local-6989586621679112592"><span id="local-6989586621679112593"><span id="local-6989586621679112594"><span id="local-6989586621679112595"><span id="local-6989586621679112596"><span id="local-6989586621679112597"><span id="local-6989586621679112598"><span id="local-6989586621679112599"><span id="local-6989586621679112600"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112588"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112587"><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112587"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span id="local-6989586621679112586"><span class="annot"><span class="annottext">Word16 -&gt; MQTTPkt
</span><a href="#local-6989586621679112586"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679112585"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112585"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679112584"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112584"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679112583"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112583"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679112582"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112582"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; [DispatchType] -&gt; STM (TChan MQTTPkt, Word16)
</span><a href="Network.MQTT.Client.html#reservePktID"><span class="hs-identifier hs-var">reservePktID</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112601"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112587"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; STM ()
</span><a href="Network.MQTT.Client.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112601"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; MQTTPkt
</span><a href="#local-6989586621679112586"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112582"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112583"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112582"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-comment">-- Wait for the response in a separate transaction.</span><span>
</span><span id="line-587"></span><span>  </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-588"></span><span>    </span><span id="local-6989586621679112581"><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679112581"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112595"><span class="hs-identifier hs-var">_st</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnState
</span><a href="#local-6989586621679112581"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Connected"><span class="hs-identifier hs-var">Connected</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;disconnected waiting for response&quot;</span></span><span>
</span><span id="line-590"></span><span>    </span><span class="annot"><span class="annottext">MQTTClient -&gt; (DispatchType, Word16) -&gt; STM ()
</span><a href="Network.MQTT.Client.html#releasePktID"><span class="hs-identifier hs-var">releasePktID</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112601"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112587"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112584"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112585"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span class="hs-comment">-- | Subscribe to a list of topic filters with their respective 'QoS'es.</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- The accepted 'QoS'es are returned in the same order as requested.</span><span>
</span><span id="line-595"></span><span class="annot"><a href="Network.MQTT.Client.html#subscribe"><span class="hs-identifier hs-type">subscribe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Topic.html#Filter"><span class="hs-identifier hs-type">Filter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#SubOptions"><span class="hs-identifier hs-type">SubOptions</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#SubErr"><span class="hs-identifier hs-type">SubErr</span></a></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#QoS"><span class="hs-identifier hs-type">QoS</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span id="subscribe"><span class="annot"><span class="annottext">subscribe :: MQTTClient
-&gt; [(Filter, SubOptions)]
-&gt; [Property]
-&gt; IO ([Either SubErr QoS], [Property])
</span><a href="Network.MQTT.Client.html#subscribe"><span class="hs-identifier hs-var hs-var">subscribe</span></a></span></span><span> </span><span id="local-6989586621679112580"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112580"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679112579"><span class="annot"><span class="annottext">[(Filter, SubOptions)]
</span><a href="#local-6989586621679112579"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621679112578"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112578"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-597"></span><span>  </span><span class="annot"><span class="annottext">MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#runCallbackThread"><span class="hs-identifier hs-var">runCallbackThread</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112580"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="annot"><span class="annottext">MQTTClient -&gt; DispatchType -&gt; (Word16 -&gt; MQTTPkt) -&gt; IO MQTTPkt
</span><a href="Network.MQTT.Client.html#sendAndWait"><span class="hs-identifier hs-var">sendAndWait</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112580"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DSubACK"><span class="hs-identifier hs-var">DSubACK</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679112577"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112577"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SubscribeRequest -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#SubscribePkt"><span class="hs-identifier hs-var">SubscribePkt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word16
-&gt; [(ByteString, SubOptions)] -&gt; [Property] -&gt; SubscribeRequest
</span><a href="Network.MQTT.Types.html#SubscribeRequest"><span class="hs-identifier hs-var">SubscribeRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112577"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">[(ByteString, SubOptions)]
</span><a href="#local-6989586621679112575"><span class="hs-identifier hs-var">ls'</span></a></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112578"><span class="hs-identifier hs-var">props</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><a href="Network.MQTT.Types.html#SubACKPkt"><span class="hs-identifier hs-type">SubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#SubscribeResponse"><span class="hs-identifier hs-type">SubscribeResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112574"><span class="annot"><span class="annottext">[Either SubErr QoS]
</span><a href="#local-6989586621679112574"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621679112573"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112573"><span class="hs-identifier hs-var">aprops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either SubErr QoS]
</span><a href="#local-6989586621679112574"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112573"><span class="hs-identifier hs-var">aprops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>    </span><span id="local-6989586621679112572"><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112572"><span class="hs-identifier hs-var">pkt</span></a></span></span><span>                                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected response to subscribe: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112572"><span class="hs-identifier hs-var">pkt</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112575"><span class="annot"><span class="annottext">ls' :: [(ByteString, SubOptions)]
</span><a href="#local-6989586621679112575"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; ByteString
</span><a href="Network.MQTT.Client.html#filterToBL"><span class="hs-identifier hs-var">filterToBL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Filter, SubOptions)]
</span><a href="#local-6989586621679112579"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="hs-comment">-- | Unsubscribe from a list of topic filters.</span><span>
</span><span id="line-605"></span><span class="hs-comment">--</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- In MQTT 3.1.1, there is no body to an unsubscribe response, so it</span><span>
</span><span id="line-607"></span><span class="hs-comment">-- can be ignored.  If this returns, you were unsubscribed.  In MQTT</span><span>
</span><span id="line-608"></span><span class="hs-comment">-- 5, you'll get a list of unsub status values corresponding to your</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- request filters, and whatever properties the server thought you</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- should know about.</span><span>
</span><span id="line-611"></span><span class="annot"><a href="Network.MQTT.Client.html#unsubscribe"><span class="hs-identifier hs-type">unsubscribe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Topic.html#Filter"><span class="hs-identifier hs-type">Filter</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#UnsubStatus"><span class="hs-identifier hs-type">UnsubStatus</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span id="unsubscribe"><span class="annot"><span class="annottext">unsubscribe :: MQTTClient
-&gt; [Filter] -&gt; [Property] -&gt; IO ([UnsubStatus], [Property])
</span><a href="Network.MQTT.Client.html#unsubscribe"><span class="hs-identifier hs-var hs-var">unsubscribe</span></a></span></span><span> </span><span id="local-6989586621679112569"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112569"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679112568"><span class="annot"><span class="annottext">[Filter]
</span><a href="#local-6989586621679112568"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621679112567"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112567"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#UnsubACKPkt"><span class="hs-identifier hs-type">UnsubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#UnsubscribeResponse"><span class="hs-identifier hs-type">UnsubscribeResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112566"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112566"><span class="hs-identifier hs-var">rsn</span></a></span></span><span> </span><span id="local-6989586621679112565"><span class="annot"><span class="annottext">[UnsubStatus]
</span><a href="#local-6989586621679112565"><span class="hs-identifier hs-var">rprop</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; DispatchType -&gt; (Word16 -&gt; MQTTPkt) -&gt; IO MQTTPkt
</span><a href="Network.MQTT.Client.html#sendAndWait"><span class="hs-identifier hs-var">sendAndWait</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112569"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DUnsubACK"><span class="hs-identifier hs-var">DUnsubACK</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679112564"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112564"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnsubscribeRequest -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#UnsubscribePkt"><span class="hs-identifier hs-var">UnsubscribePkt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; [ByteString] -&gt; [Property] -&gt; UnsubscribeRequest
</span><a href="Network.MQTT.Types.html#UnsubscribeRequest"><span class="hs-identifier hs-var">UnsubscribeRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112564"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; ByteString
</span><a href="Network.MQTT.Client.html#filterToBL"><span class="hs-identifier hs-var">filterToBL</span></a></span><span> </span><span class="annot"><span class="annottext">[Filter]
</span><a href="#local-6989586621679112568"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112567"><span class="hs-identifier hs-var">props</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnsubStatus]
</span><a href="#local-6989586621679112565"><span class="hs-identifier hs-var">rprop</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112566"><span class="hs-identifier hs-var">rsn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="hs-comment">-- | Publish a message (QoS 0).</span><span>
</span><span id="line-617"></span><span class="annot"><a href="Network.MQTT.Client.html#publish"><span class="hs-identifier hs-type">publish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span>         </span><span class="hs-comment">-- ^ Topic</span><span>
</span><span id="line-619"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-comment">-- ^ Message body</span><span>
</span><span id="line-620"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- ^ Retain flag</span><span>
</span><span id="line-621"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span id="publish"><span class="annot"><span class="annottext">publish :: MQTTClient -&gt; Topic -&gt; ByteString -&gt; Bool -&gt; IO ()
</span><a href="Network.MQTT.Client.html#publish"><span class="hs-identifier hs-var hs-var">publish</span></a></span></span><span> </span><span id="local-6989586621679112562"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112562"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679112561"><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112561"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679112560"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112560"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679112559"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112559"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient
-&gt; Topic -&gt; ByteString -&gt; Bool -&gt; QoS -&gt; [Property] -&gt; IO ()
</span><a href="Network.MQTT.Client.html#publishq"><span class="hs-identifier hs-var">publishq</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112562"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112561"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112560"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112559"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS0"><span class="hs-identifier hs-var">QoS0</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-comment">-- | Publish a message with the specified QoS and Properties list.</span><span>
</span><span id="line-625"></span><span class="annot"><a href="Network.MQTT.Client.html#publishq"><span class="hs-identifier hs-type">publishq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-626"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span>         </span><span class="hs-comment">-- ^ Topic</span><span>
</span><span id="line-627"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-comment">-- ^ Message body</span><span>
</span><span id="line-628"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- ^ Retain flag</span><span>
</span><span id="line-629"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#QoS"><span class="hs-identifier hs-type">QoS</span></a></span><span>           </span><span class="hs-comment">-- ^ QoS</span><span>
</span><span id="line-630"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Properties</span><span>
</span><span id="line-631"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span id="publishq"><span class="annot"><span class="annottext">publishq :: MQTTClient
-&gt; Topic -&gt; ByteString -&gt; Bool -&gt; QoS -&gt; [Property] -&gt; IO ()
</span><a href="Network.MQTT.Client.html#publishq"><span class="hs-identifier hs-var hs-var">publishq</span></a></span></span><span> </span><span id="local-6989586621679112558"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679112557"><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112557"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679112556"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112556"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679112555"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112555"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679112554"><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112554"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679112553"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112553"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679112552"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112552"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679112551"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112551"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; [DispatchType] -&gt; STM (TChan MQTTPkt, Word16)
</span><a href="Network.MQTT.Client.html#reservePktID"><span class="hs-identifier hs-var">reservePktID</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[DispatchType]
</span><a href="#local-6989586621679112550"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span class="annot"><span class="annottext">forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">E.finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChan MQTTPkt -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112549"><span class="hs-identifier hs-var">publishAndWait</span></a></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112552"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112551"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; [(DispatchType, Word16)] -&gt; STM ()
</span><a href="Network.MQTT.Client.html#releasePktIDs"><span class="hs-identifier hs-var">releasePktIDs</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112548"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112551"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679112548"><span class="annot"><span class="annottext">DispatchType
</span><a href="#local-6989586621679112548"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DispatchType]
</span><a href="#local-6989586621679112550"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-637"></span><span>      </span><span id="local-6989586621679112550"><span class="annot"><span class="annottext">types :: [DispatchType]
</span><a href="#local-6989586621679112550"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubACK"><span class="hs-identifier hs-var">DPubACK</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubREC"><span class="hs-identifier hs-var">DPubREC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DispatchType
</span><a href="Network.MQTT.Client.html#DPubCOMP"><span class="hs-identifier hs-var">DPubCOMP</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-638"></span><span>      </span><span id="local-6989586621679112549"><span class="annot"><span class="annottext">publishAndWait :: TChan MQTTPkt -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112549"><span class="hs-identifier hs-var hs-var">publishAndWait</span></a></span></span><span> </span><span id="local-6989586621679112543"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112543"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679112542"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112542"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var">sendPacketIO</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; MQTTPkt
</span><a href="#local-6989586621679112541"><span class="hs-identifier hs-var">pkt</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112542"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112554"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS0"><span class="hs-identifier hs-var">QoS0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112539"><span class="hs-identifier hs-var">satisfyQoS</span></a></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112543"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112542"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>      </span><span id="local-6989586621679112541"><span class="annot"><span class="annottext">pkt :: Word16 -&gt; MQTTPkt
</span><a href="#local-6989586621679112541"><span class="hs-identifier hs-var hs-var">pkt</span></a></span></span><span> </span><span id="local-6989586621679112538"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112538"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PublishRequest -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PublishPkt"><span class="hs-identifier hs-var">PublishPkt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#PublishRequest"><span class="hs-identifier hs-type">PublishRequest</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_pubDup :: Bool
</span><a href="Network.MQTT.Types.html#_pubDup"><span class="hs-identifier hs-var">_pubDup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-643"></span><span>                                             </span><span class="annot"><span class="annottext">_pubQoS :: QoS
</span><a href="Network.MQTT.Types.html#_pubQoS"><span class="hs-identifier hs-var">_pubQoS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112554"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-644"></span><span>                                             </span><span class="annot"><span class="annottext">_pubPktID :: Word16
</span><a href="Network.MQTT.Types.html#_pubPktID"><span class="hs-identifier hs-var">_pubPktID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112538"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-645"></span><span>                                             </span><span class="annot"><span class="annottext">_pubRetain :: Bool
</span><a href="Network.MQTT.Types.html#_pubRetain"><span class="hs-identifier hs-var">_pubRetain</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112555"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-646"></span><span>                                             </span><span class="annot"><span class="annottext">_pubTopic :: ByteString
</span><a href="Network.MQTT.Types.html#_pubTopic"><span class="hs-identifier hs-var">_pubTopic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Topic -&gt; ByteString
</span><a href="Network.MQTT.Client.html#topicToBL"><span class="hs-identifier hs-var">topicToBL</span></a></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112557"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-647"></span><span>                                             </span><span class="annot"><span class="annottext">_pubBody :: ByteString
</span><a href="Network.MQTT.Types.html#_pubBody"><span class="hs-identifier hs-var">_pubBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112556"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-648"></span><span>                                             </span><span class="annot"><span class="annottext">_pubProps :: [Property]
</span><a href="Network.MQTT.Types.html#_pubProps"><span class="hs-identifier hs-var">_pubProps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112553"><span class="hs-identifier hs-var">props</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span>      </span><span id="local-6989586621679112539"><span class="annot"><span class="annottext">satisfyQoS :: TChan MQTTPkt -&gt; Word16 -&gt; IO ()
</span><a href="#local-6989586621679112539"><span class="hs-identifier hs-var hs-var">satisfyQoS</span></a></span></span><span> </span><span id="local-6989586621679112511"><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112511"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679112510"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112510"><span class="hs-identifier hs-var">pid</span></a></span></span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112554"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS0"><span class="hs-identifier hs-var">QoS0</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112554"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS1"><span class="hs-identifier hs-var">QoS1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubACKPkt"><span class="hs-identifier hs-type">PubACKPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubACK"><span class="hs-identifier hs-type">PubACK</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112509"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112509"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679112508"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112508"><span class="hs-identifier hs-var">pprops</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112511"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. (Eq a, Num a) =&gt; a -&gt; Bool
</span><a href="#local-6989586621679112507"><span class="hs-identifier hs-var">isOK</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112509"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qos 1 publish error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112509"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112508"><span class="hs-identifier hs-var">pprops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112554"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS2"><span class="hs-identifier hs-var">QoS2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679112506"><span class="hs-identifier hs-var">waitRec</span></a></span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid QoS&quot;</span></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-659"></span><span>          </span><span id="local-6989586621679112507"><span class="annot"><span class="annottext">isOK :: a -&gt; Bool
</span><a href="#local-6989586621679112507"><span class="hs-identifier hs-var hs-var">isOK</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- success</span><span>
</span><span id="line-660"></span><span>          </span><span class="annot"><a href="#local-6989586621679112507"><span class="hs-identifier hs-var">isOK</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">16</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- It worked, but nobody cares (no matching subscribers)</span><span>
</span><span id="line-661"></span><span>          </span><span class="annot"><a href="#local-6989586621679112507"><span class="hs-identifier hs-var">isOK</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span>          </span><span id="local-6989586621679112506"><span class="annot"><span class="annottext">waitRec :: IO ()
</span><a href="#local-6989586621679112506"><span class="hs-identifier hs-var hs-var">waitRec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ()
</span><a href="Network.MQTT.Client.html#checkConnected"><span class="hs-identifier hs-var">checkConnected</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan MQTTPkt
</span><a href="#local-6989586621679112511"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-664"></span><span>              </span><span class="annot"><a href="Network.MQTT.Types.html#PubRECPkt"><span class="hs-identifier hs-type">PubRECPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubREC"><span class="hs-identifier hs-type">PubREC</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112468"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112468"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679112467"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112467"><span class="hs-identifier hs-var">recprops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. (Eq a, Num a) =&gt; a -&gt; Bool
</span><a href="#local-6989586621679112507"><span class="hs-identifier hs-var">isOK</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112468"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qos 2 REC publish error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112468"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112467"><span class="hs-identifier hs-var">recprops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>                </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var">sendPacketIO</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112558"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubREL -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#PubRELPkt"><span class="hs-identifier hs-var">PubRELPkt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word8 -&gt; [Property] -&gt; PubREL
</span><a href="Network.MQTT.Types.html#PubREL"><span class="hs-identifier hs-var">PubREL</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112510"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>              </span><span class="annot"><a href="Network.MQTT.Types.html#PubCOMPPkt"><span class="hs-identifier hs-type">PubCOMPPkt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PubCOMP"><span class="hs-identifier hs-type">PubCOMP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112466"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112466"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span id="local-6989586621679112465"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112465"><span class="hs-identifier hs-var">compprops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-668"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112466"><span class="hs-identifier hs-var">st'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qos 2 COMP publish error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679112466"><span class="hs-identifier hs-var">st'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112465"><span class="hs-identifier hs-var">compprops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>              </span><span id="local-6989586621679112464"><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112464"><span class="hs-identifier hs-var">wtf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="Network.MQTT.Client.html#mqttFail"><span class="hs-identifier hs-var">mqttFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unexpected packet received in QoS2 publish: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">MQTTPkt
</span><a href="#local-6989586621679112464"><span class="hs-identifier hs-var">wtf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">-- | Disconnect from the MQTT server.</span><span>
</span><span id="line-672"></span><span class="annot"><a href="Network.MQTT.Client.html#disconnect"><span class="hs-identifier hs-type">disconnect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#DiscoReason"><span class="hs-identifier hs-type">DiscoReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span id="disconnect"><span class="annot"><span class="annottext">disconnect :: MQTTClient -&gt; DiscoReason -&gt; [Property] -&gt; IO ()
</span><a href="Network.MQTT.Client.html#disconnect"><span class="hs-identifier hs-var hs-var">disconnect</span></a></span></span><span> </span><span id="local-6989586621679112463"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112463"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112450"><span id="local-6989586621679112451"><span id="local-6989586621679112452"><span id="local-6989586621679112453"><span id="local-6989586621679112454"><span id="local-6989586621679112455"><span id="local-6989586621679112456"><span id="local-6989586621679112457"><span id="local-6989586621679112458"><span id="local-6989586621679112459"><span id="local-6989586621679112460"><span id="local-6989586621679112461"><span id="local-6989586621679112462"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112450"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112449"><span class="annot"><span class="annottext">DiscoReason
</span><a href="#local-6989586621679112449"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621679112448"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112448"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. IO a -&gt; IO b -&gt; IO ()
</span><span class="hs-identifier hs-var">race_</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679112447"><span class="hs-identifier hs-var">getDisconnected</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679112446"><span class="hs-identifier hs-var">orDieTrying</span></a></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621679112447"><span class="annot"><span class="annottext">getDisconnected :: IO ()
</span><a href="#local-6989586621679112447"><span class="hs-identifier hs-var hs-var">getDisconnected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-676"></span><span>      </span><span class="annot"><span class="annottext">MQTTClient -&gt; MQTTPkt -&gt; IO ()
</span><a href="Network.MQTT.Client.html#sendPacketIO"><span class="hs-identifier hs-var">sendPacketIO</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112463"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DisconnectRequest -&gt; MQTTPkt
</span><a href="Network.MQTT.Types.html#DisconnectPkt"><span class="hs-identifier hs-var">DisconnectPkt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiscoReason -&gt; [Property] -&gt; DisconnectRequest
</span><a href="Network.MQTT.Types.html#DisconnectRequest"><span class="hs-identifier hs-var">DisconnectRequest</span></a></span><span> </span><span class="annot"><span class="annottext">DiscoReason
</span><a href="#local-6989586621679112449"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112448"><span class="hs-identifier hs-var">props</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
</span><a href="#local-6989586621679112456"><span class="hs-identifier hs-var">_ct</span></a></span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnState
</span><a href="#local-6989586621679112457"><span class="hs-identifier hs-var">_st</span></a></span><span> </span><span class="annot"><span class="annottext">ConnState
</span><a href="Network.MQTT.Client.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span>
</span><span id="line-679"></span><span>    </span><span id="local-6989586621679112446"><span class="annot"><span class="annottext">orDieTrying :: IO ()
</span><a href="#local-6989586621679112446"><span class="hs-identifier hs-var hs-var">orDieTrying</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10000000</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; MQTTClient -&gt; e -&gt; IO ()
</span><a href="Network.MQTT.Client.html#killConn"><span class="hs-identifier hs-var">killConn</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112463"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTException
</span><a href="Network.MQTT.Client.html#Timeout"><span class="hs-identifier hs-var">Timeout</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="hs-comment">-- | Disconnect with 'DiscoNormalDisconnection' and no properties.</span><span>
</span><span id="line-682"></span><span class="annot"><a href="Network.MQTT.Client.html#normalDisconnect"><span class="hs-identifier hs-type">normalDisconnect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span id="normalDisconnect"><span class="annot"><span class="annottext">normalDisconnect :: MQTTClient -&gt; IO ()
</span><a href="Network.MQTT.Client.html#normalDisconnect"><span class="hs-identifier hs-var hs-var">normalDisconnect</span></a></span></span><span> </span><span id="local-6989586621679112436"><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112436"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; DiscoReason -&gt; [Property] -&gt; IO ()
</span><a href="Network.MQTT.Client.html#disconnect"><span class="hs-identifier hs-var">disconnect</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112436"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">DiscoReason
</span><a href="Network.MQTT.Types.html#DiscoNormalDisconnection"><span class="hs-identifier hs-var">DiscoNormalDisconnection</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-comment">-- | A convenience method for creating a 'LastWill'.</span><span>
</span><span id="line-686"></span><span class="annot"><a href="Network.MQTT.Client.html#mkLWT"><span class="hs-identifier hs-type">mkLWT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#LastWill"><span class="hs-identifier hs-type">T.LastWill</span></a></span><span>
</span><span id="line-687"></span><span id="mkLWT"><span class="annot"><span class="annottext">mkLWT :: Topic -&gt; ByteString -&gt; Bool -&gt; LastWill
</span><a href="Network.MQTT.Client.html#mkLWT"><span class="hs-identifier hs-var hs-var">mkLWT</span></a></span></span><span> </span><span id="local-6989586621679112434"><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112434"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679112433"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112433"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679112432"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112432"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#LastWill"><span class="hs-identifier hs-type">T.LastWill</span></a></span><span class="hs-special">{</span><span>
</span><span id="line-688"></span><span>  </span><span class="annot"><span class="annottext">_willRetain :: Bool
</span><a href="Network.MQTT.Types.html#_willRetain"><span class="hs-identifier hs-var">T._willRetain</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112432"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="annottext">_willQoS :: QoS
</span><a href="Network.MQTT.Types.html#_willQoS"><span class="hs-identifier hs-var">T._willQoS</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">QoS
</span><a href="Network.MQTT.Types.html#QoS0"><span class="hs-identifier hs-var">QoS0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><span class="annottext">_willTopic :: ByteString
</span><a href="Network.MQTT.Types.html#_willTopic"><span class="hs-identifier hs-var">T._willTopic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Topic -&gt; ByteString
</span><a href="Network.MQTT.Client.html#topicToBL"><span class="hs-identifier hs-var">topicToBL</span></a></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112434"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><span class="annottext">_willMsg :: ByteString
</span><a href="Network.MQTT.Types.html#_willMsg"><span class="hs-identifier hs-var">T._willMsg</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112433"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><span class="annottext">_willProps :: [Property]
</span><a href="Network.MQTT.Types.html#_willProps"><span class="hs-identifier hs-var">T._willProps</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="hs-comment">-- | Get the list of properties that were sent from the broker at connect time.</span><span>
</span><span id="line-696"></span><span class="annot"><a href="Network.MQTT.Client.html#svrProps"><span class="hs-identifier hs-type">svrProps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-697"></span><span id="svrProps"><span class="annot"><span class="annottext">svrProps :: MQTTClient -&gt; IO [Property]
</span><a href="Network.MQTT.Client.html#svrProps"><span class="hs-identifier hs-var hs-var">svrProps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ConnACKFlags -&gt; [Property]
</span><a href="#local-6989586621679112425"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ConnACKFlags
</span><a href="Network.MQTT.Client.html#connACKSTM"><span class="hs-identifier hs-var">connACKSTM</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112425"><span class="annot"><span class="annottext">p :: ConnACKFlags -&gt; [Property]
</span><a href="#local-6989586621679112425"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-type">ConnACKFlags</span></a></span><span> </span><span class="annot"><span class="annottext">SessionReuse
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConnACKRC
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112424"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112424"><span class="hs-identifier hs-var">props</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112424"><span class="hs-identifier hs-var">props</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-comment">-- | Get the complete connection ACK packet from the beginning of this session.</span><span>
</span><span id="line-701"></span><span class="annot"><a href="Network.MQTT.Client.html#connACKSTM"><span class="hs-identifier hs-type">connACKSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-type">ConnACKFlags</span></a></span><span>
</span><span id="line-702"></span><span id="connACKSTM"><span class="annot"><span class="annottext">connACKSTM :: MQTTClient -&gt; STM ConnACKFlags
</span><a href="Network.MQTT.Client.html#connACKSTM"><span class="hs-identifier hs-var hs-var">connACKSTM</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112423"><span class="annot"><span class="annottext">TVar ConnACKFlags
_connACKFlags :: TVar ConnACKFlags
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
</span><a href="#local-6989586621679112423"><span class="hs-identifier hs-var hs-var">_connACKFlags</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ConnACKFlags
</span><a href="#local-6989586621679112423"><span class="hs-identifier hs-var">_connACKFlags</span></a></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">-- | Get the complete connection aCK packet from the beginning of this session.</span><span>
</span><span id="line-705"></span><span class="annot"><a href="Network.MQTT.Client.html#connACK"><span class="hs-identifier hs-type">connACK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#ConnACKFlags"><span class="hs-identifier hs-type">ConnACKFlags</span></a></span><span>
</span><span id="line-706"></span><span id="connACK"><span class="annot"><span class="annottext">connACK :: MQTTClient -&gt; IO ConnACKFlags
</span><a href="Network.MQTT.Client.html#connACK"><span class="hs-identifier hs-var hs-var">connACK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; STM ConnACKFlags
</span><a href="Network.MQTT.Client.html#connACKSTM"><span class="hs-identifier hs-var">connACKSTM</span></a></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="annot"><a href="Network.MQTT.Client.html#maxAliases"><span class="hs-identifier hs-type">maxAliases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-709"></span><span id="maxAliases"><span class="annot"><span class="annottext">maxAliases :: MQTTClient -&gt; IO Word16
</span><a href="Network.MQTT.Client.html#maxAliases"><span class="hs-identifier hs-var hs-var">maxAliases</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Property -&gt; Word16 -&gt; Word16
</span><a href="#local-6989586621679112421"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; IO [Property]
</span><a href="Network.MQTT.Client.html#svrProps"><span class="hs-identifier hs-var">svrProps</span></a></span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-711"></span><span>    </span><span id="local-6989586621679112421"><span class="annot"><span class="annottext">f :: Property -&gt; Word16 -&gt; Word16
</span><a href="#local-6989586621679112421"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.MQTT.Types.html#PropTopicAliasMaximum"><span class="hs-identifier hs-type">PropTopicAliasMaximum</span></a></span><span> </span><span id="local-6989586621679112419"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112419"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112419"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><a href="#local-6989586621679112421"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Property
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679112418"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112418"><span class="hs-identifier hs-var">o</span></a></span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112418"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="hs-comment">-- | Publish a message with the specified 'QoS' and 'Property' list.  If</span><span>
</span><span id="line-715"></span><span class="hs-comment">-- possible, use an alias to shorten the message length.  The alias</span><span>
</span><span id="line-716"></span><span class="hs-comment">-- list is managed by the client in a first-come, first-served basis,</span><span>
</span><span id="line-717"></span><span class="hs-comment">-- so if you use this with more properties than the broker allows,</span><span>
</span><span id="line-718"></span><span class="hs-comment">-- only the first N (up to TopicAliasMaximum, as specified by the</span><span>
</span><span id="line-719"></span><span class="hs-comment">-- broker at connect time) will be aliased.</span><span>
</span><span id="line-720"></span><span class="hs-comment">--</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- This is safe to use as a general publish mechanism, as it will</span><span>
</span><span id="line-722"></span><span class="hs-comment">-- default to not aliasing whenver there's not already an alias and we</span><span>
</span><span id="line-723"></span><span class="hs-comment">-- can't create any more.</span><span>
</span><span id="line-724"></span><span class="annot"><a href="Network.MQTT.Client.html#pubAliased"><span class="hs-identifier hs-type">pubAliased</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span>
</span><span id="line-725"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Topic.html#Topic"><span class="hs-identifier hs-type">Topic</span></a></span><span>         </span><span class="hs-comment">-- ^ Topic</span><span>
</span><span id="line-726"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-comment">-- ^ Message body</span><span>
</span><span id="line-727"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- ^ Retain flag</span><span>
</span><span id="line-728"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Types.html#QoS"><span class="hs-identifier hs-type">QoS</span></a></span><span>           </span><span class="hs-comment">-- ^ QoS</span><span>
</span><span id="line-729"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.MQTT.Types.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Properties</span><span>
</span><span id="line-730"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span id="pubAliased"><span class="annot"><span class="annottext">pubAliased :: MQTTClient
-&gt; Topic -&gt; ByteString -&gt; Bool -&gt; QoS -&gt; [Property] -&gt; IO ()
</span><a href="Network.MQTT.Client.html#pubAliased"><span class="hs-identifier hs-var hs-var">pubAliased</span></a></span></span><span> </span><span id="local-6989586621679112417"><span class="annot"><span class="annottext">c :: MQTTClient
</span><a href="#local-6989586621679112417"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112404"><span id="local-6989586621679112405"><span id="local-6989586621679112406"><span id="local-6989586621679112407"><span id="local-6989586621679112408"><span id="local-6989586621679112409"><span id="local-6989586621679112410"><span id="local-6989586621679112411"><span id="local-6989586621679112412"><span id="local-6989586621679112413"><span id="local-6989586621679112414"><span id="local-6989586621679112415"><span id="local-6989586621679112416"><span class="annot"><span class="annottext">TVar (Maybe (Async ()))
TVar Word16
TVar (Map Word16 Topic)
TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
TVar (Map Topic Word16)
TVar ConnACKFlags
TVar ConnState
MVar (IO ())
TChan MQTTPkt
Map Word16 PublishRequest
Map ByteString MessageCallback
MessageCallback
_cbHandle :: TVar (Maybe (Async ()))
_cbM :: MVar (IO ())
_corr :: Map ByteString MessageCallback
_connACKFlags :: TVar ConnACKFlags
_inA :: TVar (Map Word16 Topic)
_outA :: TVar (Map Topic Word16)
_ct :: TVar (Maybe (Async ()))
_st :: TVar ConnState
_inflight :: Map Word16 PublishRequest
_acks :: TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MessageCallback
_pktID :: TVar Word16
_ch :: TChan MQTTPkt
_cbHandle :: MQTTClient -&gt; TVar (Maybe (Async ()))
_cbM :: MQTTClient -&gt; MVar (IO ())
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
_connACKFlags :: MQTTClient -&gt; TVar ConnACKFlags
_inA :: MQTTClient -&gt; TVar (Map Word16 Topic)
_outA :: MQTTClient -&gt; TVar (Map Topic Word16)
_ct :: MQTTClient -&gt; TVar (Maybe (Async ()))
_st :: MQTTClient -&gt; TVar ConnState
_inflight :: MQTTClient -&gt; Map Word16 PublishRequest
_acks :: MQTTClient -&gt; TVar (Map (DispatchType, Word16) (TChan MQTTPkt))
_cb :: MQTTClient -&gt; MessageCallback
_pktID :: MQTTClient -&gt; TVar Word16
_ch :: MQTTClient -&gt; TChan MQTTPkt
</span><a href="#local-6989586621679112404"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112403"><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112403"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679112402"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112402"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679112401"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112401"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679112400"><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112400"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679112399"><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112399"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-732"></span><span>  </span><span id="local-6989586621679112398"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112398"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MQTTClient -&gt; IO Word16
</span><a href="Network.MQTT.Client.html#maxAliases"><span class="hs-identifier hs-var">maxAliases</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112417"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679112397"><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112397"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679112396"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112396"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; IO (Topic, Word16)
</span><a href="#local-6989586621679112395"><span class="hs-identifier hs-var">alias</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112398"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112390"><span class="annot"><span class="annottext">np :: [Property]
</span><a href="#local-6989586621679112390"><span class="hs-identifier hs-var hs-var">np</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112399"><span class="hs-identifier hs-var">props</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112396"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-735"></span><span>                      </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-736"></span><span>                      </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word16 -&gt; Property
</span><a href="Network.MQTT.Types.html#PropTopicAlias"><span class="hs-identifier hs-var">PropTopicAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112396"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><span class="annottext">MQTTClient
-&gt; Topic -&gt; ByteString -&gt; Bool -&gt; QoS -&gt; [Property] -&gt; IO ()
</span><a href="Network.MQTT.Client.html#publishq"><span class="hs-identifier hs-var">publishq</span></a></span><span> </span><span class="annot"><span class="annottext">MQTTClient
</span><a href="#local-6989586621679112417"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112397"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112402"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112401"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">QoS
</span><a href="#local-6989586621679112400"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[Property]
</span><a href="#local-6989586621679112390"><span class="hs-identifier hs-var">np</span></a></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-740"></span><span>    </span><span id="local-6989586621679112395"><span class="annot"><span class="annottext">alias :: Word16 -&gt; IO (Topic, Word16)
</span><a href="#local-6989586621679112395"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span id="local-6989586621679112380"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112380"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>      </span><span id="local-6989586621679112379"><span class="annot"><span class="annottext">Map Topic Word16
</span><a href="#local-6989586621679112379"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map Topic Word16)
</span><a href="#local-6989586621679112409"><span class="hs-identifier hs-var">_outA</span></a></span><span>
</span><span id="line-742"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112373"><span class="annot"><span class="annottext">n :: Word16
</span><a href="#local-6989586621679112373"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Map Topic Word16
</span><a href="#local-6989586621679112379"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>          </span><span id="local-6989586621679112369"><span class="annot"><span class="annottext">cur :: Maybe Word16
</span><a href="#local-6989586621679112369"><span class="hs-identifier hs-var hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112403"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Map Topic Word16
</span><a href="#local-6989586621679112379"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-744"></span><span>          </span><span id="local-6989586621679112366"><span class="annot"><span class="annottext">v :: Word16
</span><a href="#local-6989586621679112366"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112373"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112380"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112373"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Word16
</span><a href="#local-6989586621679112369"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-745"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112366"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar (Map Topic Word16)
</span><a href="#local-6989586621679112409"><span class="hs-identifier hs-var">_outA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112403"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112366"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Topic Word16
</span><a href="#local-6989586621679112379"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Topic
</span><a href="#local-6989586621679112403"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Topic
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Word16
</span><a href="#local-6989586621679112369"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679112366"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span class="hs-comment">-- | Register a callback handler for a message with the given correlated data identifier.</span><span>
</span><span id="line-749"></span><span class="hs-comment">--</span><span>
</span><span id="line-750"></span><span class="hs-comment">-- This registration will remain in place until unregisterCorrelated is called to remove it.</span><span>
</span><span id="line-751"></span><span class="annot"><a href="Network.MQTT.Client.html#registerCorrelated"><span class="hs-identifier hs-type">registerCorrelated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MessageCallback"><span class="hs-identifier hs-type">MessageCallback</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span id="registerCorrelated"><span class="annot"><span class="annottext">registerCorrelated :: MQTTClient -&gt; ByteString -&gt; MessageCallback -&gt; STM ()
</span><a href="Network.MQTT.Client.html#registerCorrelated"><span class="hs-identifier hs-var hs-var">registerCorrelated</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112365"><span class="annot"><span class="annottext">Map ByteString MessageCallback
_corr :: Map ByteString MessageCallback
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
</span><a href="#local-6989586621679112365"><span class="hs-identifier hs-var hs-var">_corr</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112364"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112364"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679112363"><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112363"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. Ord k =&gt; k -&gt; v -&gt; Map k v -&gt; STM ()
</span><a href="Data.Map.Strict.Decaying.html#insert"><span class="hs-identifier hs-var">Decaying.insert</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112364"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCallback
</span><a href="#local-6989586621679112363"><span class="hs-identifier hs-var">cb</span></a></span><span> </span><span class="annot"><span class="annottext">Map ByteString MessageCallback
</span><a href="#local-6989586621679112365"><span class="hs-identifier hs-var">_corr</span></a></span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">-- | Unregister a callback handler for the given correlated data identifier.</span><span>
</span><span id="line-755"></span><span class="annot"><a href="Network.MQTT.Client.html#unregisterCorrelated"><span class="hs-identifier hs-type">unregisterCorrelated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span id="unregisterCorrelated"><span class="annot"><span class="annottext">unregisterCorrelated :: MQTTClient -&gt; ByteString -&gt; STM ()
</span><a href="Network.MQTT.Client.html#unregisterCorrelated"><span class="hs-identifier hs-var hs-var">unregisterCorrelated</span></a></span></span><span> </span><span class="annot"><a href="Network.MQTT.Client.html#MQTTClient"><span class="hs-identifier hs-type">MQTTClient</span></a></span><span class="hs-special">{</span><span id="local-6989586621679112362"><span class="annot"><span class="annottext">Map ByteString MessageCallback
_corr :: Map ByteString MessageCallback
_corr :: MQTTClient -&gt; Map ByteString MessageCallback
</span><a href="#local-6989586621679112362"><span class="hs-identifier hs-var hs-var">_corr</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679112361"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112361"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. Ord k =&gt; k -&gt; Map k v -&gt; STM ()
</span><a href="Data.Map.Strict.Decaying.html#delete"><span class="hs-identifier hs-var">Decaying.delete</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679112361"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Map ByteString MessageCallback
</span><a href="#local-6989586621679112362"><span class="hs-identifier hs-var">_corr</span></a></span><span>
</span><span id="line-757"></span></pre></body></html>